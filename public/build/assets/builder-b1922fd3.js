import{_ as D,o as n,f as d,a as e,aw as fe,t as y,z as N,A as P,s as z,k as L,j as V,E as C,ak as ve,l as Z,m as T,v as E,F,y as B,S as H,e as f,b as x,n as W,c as $,I as K,g as I,p as Q,d as R,r as j,w as U,U as be,B as ye,am as oe,ao as xe,ae as ee,$ as M,h as ge,G as ce,ax as Se,ay as ke,af as we,C as $e,D as Ce,H as Fe,J as Ue,K as Ae,L as Ie,Q as We,M as Me,O as qe,N as Le,P as De,R as Ve}from"./index-935aeafb.js";import{C as G,I as je,a as Be,A as Oe,u as le,B as de,b as ue,S as Te,F as Ne}from"./FleetItem-48be8056.js";import{u as Pe}from"./useMustAuthState-96f39df3.js";const Re={props:{label:{type:String,required:!0},modelValue:{type:Boolean,required:!0}}},Ee=t=>(N("data-v-154813cc"),t=t(),P(),t),He={class:"toggle-switch"},ze=["checked"],Ge=Ee(()=>e("span",{class:"switch"},null,-1)),Ye={class:"label"};function Je(t,s,r,i,o,c){return n(),d("label",He,[e("input",fe(t.$attrs,{class:"input",type:"checkbox",checked:r.modelValue,onChange:s[0]||(s[0]=m=>t.$emit("update:modelValue",m.target.checked))}),null,16,ze),Ge,e("span",Ye,y(r.label),1)])}const Ke=D(Re,[["render",Je],["__scopeId","data-v-154813cc"]]);const ne=t=>(N("data-v-9f8a73d4"),t=t(),P(),t),Qe=["onSubmit"],Xe={class:"form-group"},Ze=ne(()=>e("label",null,"Nickname (optional identifier for your sanity)",-1)),et=["placeholder"],tt={class:"form-group"},st=ne(()=>e("label",null,"Chip Level",-1)),ot={class:"chips flex gap-x-1"},lt=["onClick"],nt={key:0,class:"form-group"},it=ne(()=>e("label",null,"Visibility",-1)),at={class:"form-group pt-4 flex gap-x-4 justify-between"},rt=["disabled"],ct={key:0},dt=["disabled"],ut={__name:"UserShipForm",props:{ship:{type:Object,required:!0},userShip:{type:Object,default:null},onSave:{type:Function,required:!0},onDelete:{type:Function,default:null}},setup(t){const s=t,r=z(),i=L(!1),o=V({name:"",chip_level:0,visible:!0}),c=async()=>{var _,h,l;i.value=!0;try{s.onSave({...o,id_ship:s.ship.id_ship,id_user_ship:(_=s.userShip)==null?void 0:_.id_user_ship})}catch(a){r.error(((l=(h=error.response)==null?void 0:h.data)==null?void 0:l.message)||a.message)}i.value=!1},m=async _=>{var h,l;if(!s.onDelete)return!1;i.value=!0;try{s.onDelete(_)}catch(a){r.error(((l=(h=error.response)==null?void 0:h.data)==null?void 0:l.message)||a.message)}i.value=!1},b=()=>{s.userShip?(o.name=s.userShip.name,o.chip_level=s.userShip.chip_level,o.visible=s.userShip.visible):(o.name="",o.chip_level=0,o.visible=!0)},u=C(()=>ve(s.ship));return Z(()=>s.userShip,()=>{b()},{immediate:!0}),(_,h)=>(n(),d("form",{action:"",class:"user-ship-form",onSubmit:Q(c,["prevent"])},[e("div",Xe,[Ze,T(e("input",{type:"text",class:"input",placeholder:`Example: Best ${t.ship.name}`,"onUpdate:modelValue":h[0]||(h[0]=l=>o.name=l)},null,8,et),[[E,o.name]])]),e("div",tt,[st,e("div",ot,[(n(!0),d(F,null,B(f(u)+1,l=>(n(),d("div",{class:H(["chip cursor-pointer",{"chip--unlocked":l-1<=o.chip_level}]),key:l,onClick:a=>o.chip_level=l-1},y(l-1),11,lt))),128))])]),t.userShip?(n(),d("div",nt,[it,e("div",null,[x(Ke,{modelValue:o.visible,"onUpdate:modelValue":h[1]||(h[1]=l=>o.visible=l),label:o.visible?"Visible to workshops":"Hidden from workshops"},null,8,["modelValue","label"])])])):W("",!0),e("div",at,[e("div",null,[e("button",{class:"btn btn-blue",type:"submit",disabled:i.value},[i.value?(n(),$(f(K),{key:0,class:"animate-spin"})):(n(),d(F,{key:1},[I(y(t.userShip?"Update Ship":"Add Ship"),1)],64))],8,rt)]),t.userShip&&t.onDelete?(n(),d("div",ct,[e("button",{class:"btn btn-red",type:"submit",onClick:h[2]||(h[2]=Q(l=>m(t.userShip),["prevent"])),disabled:i.value},[i.value?(n(),$(f(K),{key:0,class:"animate-spin"})):(n(),d(F,{key:1},[I(" Delete ")],64))],8,dt)])):W("",!0)])],40,Qe))}},he=D(ut,[["__scopeId","data-v-9f8a73d4"]]);const ht=t=>(N("data-v-7884a63c"),t=t(),P(),t),pt={class:"ship-box__content"},_t={class:"ship-box__content-bg p-2 flex w-full gapx-3"},mt={class:"grow"},ft={class:"ship-box__strengths flex gap-x-2 items-center"},vt=ht(()=>e("div",{class:"mr-4 font-medium"},"Total Strength",-1)),bt={class:"ship-box__strengths-total text-center text-xs"},yt={class:"text-base font-medium text-grow-green-text-alt"},xt={class:"ship-box__strengths-total text-center text-xs"},gt={class:"text-base font-medium text-grow-green-text-alt"},St={class:"ship-box__strengths-total text-center text-xs"},kt={class:"text-base font-medium text-grow-green-text-alt"},wt={class:"ship-box__actions ml-auto shrink"},$t={class:"ship-box__caption"},Ct={__name:"ShipSelectCard",props:{ship:{type:Object,required:!0}},setup(t){return(s,r)=>(n(),d("div",{class:H(["ship ship-box",["ship-box--"+t.ship.ship_level.name.toLowerCase()]])},[e("div",pt,[e("div",_t,[e("div",mt,[e("div",null,"Power "+y(t.ship.energy),1),e("div",null,y(t.ship.abilities.length)+" Abilities",1),e("div",ft,[vt,e("div",bt,[I(" Weapons "),e("div",yt,y(t.ship.slotStrengths.weapon.total),1)]),e("div",xt,[I(" Armor "),e("div",gt,y(t.ship.slotStrengths.armor.total),1)]),e("div",St,[I(" Units "),e("div",kt,y(t.ship.slotStrengths.unit.total),1)])])]),e("div",wt,[R(s.$slots,"actions",{},void 0,!0)])])]),e("div",$t,y(t.ship.name),1)],2))}},Ft=D(Ct,[["__scopeId","data-v-7884a63c"]]),Ut={class:"add-ship__filters flex gap-x-4 items-center mb-4"},At=e("div",{class:"text-modal-title font-medium"},"Filter by name",-1),It=e("div",{class:"text-modal-title font-medium"},"Filter by class",-1),Wt={key:0,class:"pt-6"},Mt={class:"add-ships__list flex flex-col w-full gap-y-2"},qt=["onClick"],Lt={__name:"ShipSelectList",props:{ships:{type:Array,required:!0},shipClasses:{type:Array,required:!0}},emits:["select"],setup(t,{emit:s}){const r=t,i=u=>{s("select",u)},o=V({search:"",id_class:null}),c=C(()=>Object.values(o).some(u=>!!u)),m=()=>{o.search="",o.id_class=null},b=C(()=>{let u=[...r.ships];return o.search&&(u=u.filter(_=>_.name.toLowerCase().includes(o.search.toLowerCase()))),o.id_class&&(u=u.filter(_=>_.id_class===o.id_class)),u});return(u,_)=>{const h=j("VSelect");return n(),d(F,null,[e("div",Ut,[e("div",null,[At,T(e("input",{type:"text",class:"input input--search",placeholder:"Search by name...","onUpdate:modelValue":_[0]||(_[0]=l=>o.search=l)},null,512),[[E,o.search]])]),e("div",null,[It,x(h,{options:t.shipClasses,reduce:l=>l.id_class,searchable:!0,clearable:!0,label:"name",modelValue:o.id_class,"onUpdate:modelValue":_[1]||(_[1]=l=>o.id_class=l)},null,8,["options","reduce","modelValue"])]),f(c)?(n(),d("div",Wt,[e("button",{class:"btn btn-sm btn-red",onClick:m}," Clear filters ")])):W("",!0)]),e("div",Mt,[(n(!0),d(F,null,B(f(b),l=>(n(),$(Ft,{key:l.id_ship,ship:l},{actions:U(()=>[e("button",{class:"btn btn-sm btn-green",onClick:a=>i(l)}," Select ",8,qt)]),_:2},1032,["ship"]))),128))])],64)}}};const Dt={class:"add-ship"},Vt={class:"text-xl text-modal-title font-medium mb-4"},jt={class:"flex gap-x-4 items-center mb-4"},Bt={class:"text-xl text-modal-title"},Ot={__name:"AddShipModal",props:{ships:{type:Array,required:!0},shipClasses:{type:Array,required:!0},onAdd:{type:Function,required:!0},title:{type:String,default:"Add a ship to your fleet"}},setup(t){const s=t,r=L(null),i=c=>{r.value=c},o=c=>s.onAdd(c);return(c,m)=>{const b=j("vue-final-modal");return n(),$(b,{classes:"modal-container","content-class":"w-full modal-content--xl"},{default:U(()=>[x(G,{class:"w-full","bg-class":"custom-bg"},{default:U(()=>[e("div",Dt,[e("h2",Vt,y(t.title),1),r.value?(n(),d(F,{key:0},[e("div",jt,[e("div",null,[e("button",{class:"btn btn-sm btn-red",onClick:m[0]||(m[0]=u=>r.value=null)}," Unselect Ship ")]),e("div",null,[e("h2",Bt,[I(" Add "),e("b",null,y(r.value.name),1),I(" to your fleet ")])])]),x(he,{ship:r.value,onSave:o},null,8,["ship"])],64)):(n(),$(Lt,{key:1,ships:t.ships,shipClasses:t.shipClasses,onSelect:i},null,8,["ships","shipClasses"]))])]),_:1})]),_:1})}}};const Tt=t=>(N("data-v-221f881d"),t=t(),P(),t),Nt={class:"ship-box__content"},Pt={class:"ship-box__content-bg p-2 flex w-full gap-x-3"},Rt={class:"shrink"},Et={class:"flex w-full justify-between"},Ht={class:"flex gap-x-2 items-center text-sm mb-1"},zt={class:"flex gap-x-[2px] items-center"},Gt={class:"ship-box__strengths flex gap-x-2 items-center"},Yt={class:"ship-box__strengths-total text-center text-xs"},Jt={class:"text-base font-medium text-grow-green-text-alt"},Kt={class:"ship-box__strengths-total text-center text-xs"},Qt={class:"text-base font-medium text-grow-green-text-alt"},Xt={class:"ship-box__strengths-total text-center text-xs"},Zt={class:"text-base font-medium text-grow-green-text-alt"},es={class:"ship__tags grow"},ts={key:0,class:"flex flex-wrap gap-[2px]"},ss={class:"ship__actions"},os=Tt(()=>e("button",{class:"btn btn-sm btn-green ml-auto"}," Edit ",-1)),ls={class:"ship-box__caption flex gap-x-4 justify-center"},ns={class:"text-white italic"},is={__name:"UserShipCard",props:{userShip:{type:Object,required:!0},showTags:{type:Boolean,default:!0}},setup(t){return(s,r)=>{const i=be("tooltip");return T((n(),d("div",{class:H(["ship ship-box relative leading-none",["ship-box--"+t.userShip.ship.ship_level.name.toLowerCase(),{"ship--hidden":!t.userShip.visible}]])},[e("div",Nt,[e("div",Pt,[e("div",Rt,[e("div",Et,[e("div",Ht,[e("div",null,y(t.userShip.ship.ship_class.name),1),e("div",zt,[e("div",null,[x(f(je))]),e("div",null,y(t.userShip.ship.energy),1)]),e("div",null,[x(Be,{total:t.userShip.ship.chipCount,chipLevel:t.userShip.chip_level,height:"8px"},null,8,["total","chipLevel"])])])]),e("div",Gt,[e("div",Yt,[I(" Weapons "),e("div",Jt,y(t.userShip.ship.slotStrengths.weapon.total),1)]),e("div",Kt,[I(" Armor "),e("div",Qt,y(t.userShip.ship.slotStrengths.armor.total),1)]),e("div",Xt,[I(" Units "),e("div",Zt,y(t.userShip.ship.slotStrengths.unit.total),1)])])]),e("div",es,[R(s.$slots,"tags",{},()=>{var o;return[t.showTags&&((o=t.userShip.parsedAbilities)!=null&&o.length)?(n(),d("div",ts,[(n(!0),d(F,null,B(t.userShip.parsedAbilities,c=>(n(),$(Oe,{key:c.ability.id_ability,parsedAbility:c},null,8,["parsedAbility"]))),128))])):W("",!0)]},!0)]),e("div",ss,[R(s.$slots,"actions",{},()=>[os],!0)])])]),e("div",ls,[e("div",null,y(t.userShip.ship.name),1),e("div",ns,y(t.userShip.name),1)])],2)),[[i,t.userShip.visible?!1:"Hidden from workshops"]])}}},ie=D(is,[["__scopeId","data-v-221f881d"]]);const as={class:"add-ship"},rs=e("h2",{class:"text-xl text-modal-title font-medium mb-4"}," Update your ship ",-1),cs={__name:"UserShipModal",props:{userShip:{type:Object,required:!0},onSave:{type:Function,required:!0},onDelete:{type:Function,default:null}},setup(t){const s=t,r=o=>s.onSave(o),i=o=>{if(s.onDelete)return s.onDelete(o)};return(o,c)=>{const m=j("vue-final-modal");return n(),$(m,{classes:"modal-container","content-class":"w-full modal-content--xl"},{default:U(()=>[x(G,{class:"w-full","bg-class":"custom-bg"},{default:U(()=>[e("div",as,[rs,x(he,{ship:t.userShip.ship,userShip:t.userShip,onSave:r,onDelete:i},null,8,["ship","userShip"])])]),_:1})]),_:1})}}};const Y=t=>(N("data-v-74af7c7c"),t=t(),P(),t),ds=["onSubmit"],us={class:"create-workshop"},hs=Y(()=>e("h2",{class:"text-xl text-modal-title font-medium mb-2"}," Create Workshop ",-1)),ps=Y(()=>e("p",{class:"text-white mb-4"},"Select your Workshop type",-1)),_s={class:"lg:flex gap-x-4 mb-4"},ms=Y(()=>e("h2",{class:"text-white text-xl mb-4"},"Arcade Workshop",-1)),fs=Y(()=>e("p",{class:"text-dark-text-white"}," Create with no restrictions! Use your same ship as many times as you want. ",-1)),vs=[ms,fs],bs=Y(()=>e("h2",{class:"text-white text-xl mb-4"},"Simulation Workshop",-1)),ys=Y(()=>e("p",{class:"text-dark-text-white"}," More realistic. You can only use each of the ships in your fleet one time. ",-1)),xs=[bs,ys],gs={class:"form-group"},Ss={class:"form-group"},ks=["disabled"],ws={__name:"WorkshopForm",props:{workshop:{type:Object,default:null},onSave:{type:Function,required:!0}},setup(t){const s=t,r=z(),i=V({name:"",arcade:!0}),o=V({name:""}),c=V({name:!1}),m=L(!1),b=L(!1),u=()=>(o.name=i.name?"":"Name is required",!Object.values(o).some(h=>h)),_=async()=>{if(m.value=!0,b.value)try{await s.onSave(i)}catch(h){r.error(h.message)}m.value=!1};return Z(i,()=>{b.value=u()}),ye(()=>{s.workshop&&(i.name=s.workshop.name,i.arcade=s.workshop.arcade)}),(h,l)=>(n(),d("form",{action:"",onSubmit:Q(_,["prevent"])},[e("div",us,[hs,ps,e("div",_s,[e("div",{class:H(["p-4 bordered lg:w-1/2 text-center",{"bordered--selected":i.arcade}]),onClick:l[0]||(l[0]=a=>i.arcade=!0)},vs,2),e("div",{class:H(["p-4 bordered lg:w-1/2",{"bordered--selected":!i.arcade}]),onClick:l[1]||(l[1]=a=>i.arcade=!1)},xs,2)]),e("div",gs,[T(e("input",{class:"input",type:"text",placeholder:"Fleet name","onUpdate:modelValue":l[2]||(l[2]=a=>i.name=a)},null,512),[[E,i.name]]),x(oe,{error:o.name,dirty:c.name},null,8,["error","dirty"])]),e("div",Ss,[e("button",{class:"btn btn-blue",disabled:!b.value}," Create Workshop ",8,ks)])])],40,ds))}},$s=D(ws,[["__scopeId","data-v-74af7c7c"]]);const Cs={__name:"CreateWorkshopModal",props:{workshop:{type:Object,default:null},onSave:{type:Function,required:!0}},setup(t){const s=t;return(r,i)=>{const o=j("vue-final-modal");return n(),$(o,{classes:"modal-container","content-class":"w-full modal-content--xl"},{default:U(()=>[x(G,{class:"w-full","bg-class":"custom-bg"},{default:U(()=>[x($s,{onSave:s.onSave,workshop:t.workshop},null,8,["onSave","workshop"])]),_:1})]),_:1})}}},Fs=D(Cs,[["__scopeId","data-v-ee57fd14"]]);const Us={class:"flex items-center"},As={class:"border-r border-dark-border-end pr-4 grow"},Is={class:"flex w-100"},Ws={class:"mr-4"},Ms={class:"text-sm text-dark-text"},qs={class:"text-2xl font-medium text-dark-text leading-none text-white"},Ls={class:"self-end ml-auto"},Ds={class:"text-sm"},Vs={class:"text-sm"},js={class:"pl-4 shrink"},Bs=["onClick"],Os={__name:"WorkshopListItem",props:{workshop:{type:Object,default:null},onDelete:{type:Function,required:!0}},emits:["select"],setup(t,{emit:s}){const r=t,i=C(()=>r.workshop.fleets.length),o=C(()=>r.workshop.fleets.reduce((b,u)=>b+u.user_ships.length,0)),c=()=>{r.onDelete(ee(r.workshop))},m=()=>{s("select",ee(r.workshop))};return(b,u)=>(n(),d("div",{class:"workshop-list-item cursor-pointer p-4",onClick:m},[e("div",Us,[e("div",As,[e("div",Is,[e("div",Ws,[e("div",Ms,y(t.workshop.arcade?"Arcade":"Simulation"),1),e("div",qs,y(t.workshop.name),1)]),e("div",Ls,[e("div",Ds,[I(" Ships: "),e("b",null,y(f(o)),1)]),e("div",Vs,[I(" Fleets: "),e("b",null,y(f(i)),1)])])])]),e("div",js,[e("button",{class:"btn btn-red btn-sm",onClick:Q(c,["stop","prevent"])},[x(f(xe))],8,Bs)])])]))}},Ts=D(Os,[["__scopeId","data-v-454717a1"]]);const Ns={class:"modal__title text-2xl font-medium mb-8"},Ps={class:"modal__content p-6 mb-6"},Rs={class:"modal__footer flex justify-end items-center gap-x-3"},Es=["onClick"],Hs=["onClick"],se=t=>{M.show({component:"confirm-modal",bind:{title:t.title,message:t.message,onConfirm:t.onConfirm,onCancel:t.onCancel,confirmBtnClass:t.confirmBtnClass}})},zs={__name:"ConfirmModal",props:{onConfirm:{type:Function,required:!0},onCancel:{type:Function,default:null},title:{type:String,default:!1},message:{type:String,default:!1},confirmBtnClass:{type:String,default:"btn-red"}},setup(t){const s=t,r=o=>{s.onCancel(),o()},i=o=>{typeof s.onConfirm=="function"&&s.onConfirm(),o()};return(o,c)=>{const m=j("vue-final-modal");return n(),$(m,{name:"confirm-modal",classes:"modal-container","content-class":"w-full modal-content--xl"},{default:U(({close:b})=>[x(G,{class:"w-full text-modal-text","bg-class":"custom-bg"},{default:U(()=>[e("div",Ns,[R(o.$slots,"title",{},()=>[I(y(t.title),1)],!0)]),e("div",Ps,[R(o.$slots,"default",{},()=>[I(y(t.message),1)],!0)]),e("div",Rs,[R(o.$slots,"buttons",{},()=>[e("button",{class:"btn btn-blue",onClick:u=>r(b)}," Cancel ",8,Es),e("button",{class:H(["btn",t.confirmBtnClass]),onClick:u=>i(b)}," Confirm ",10,Hs)],!0)])]),_:2},1024)]),_:3})}}},Gs=D(zs,[["__scopeId","data-v-53e089bb"]]);const pe=t=>(N("data-v-307b12f5"),t=t(),P(),t),Ys={class:"my-fleets flex w-full justify-center items-center"},Js={class:"my-fleets__content w-full max-w-6xl p-6 text-modal-text"},Ks={class:"lg:flex w-full items-stretch gap-x-6"},Qs={class:"my-fleets__fleets h-full grow"},Xs={class:"flex items-end w-full mb-2"},Zs=pe(()=>e("div",null,[e("div",{class:"title text-2xl text-modal-title font-medium leading-none"}," My Ships ")],-1)),eo={class:"ml-auto"},to={class:"bordered p-4"},so={class:"user-ships grid grid-cols-2 gap-3 w-full"},oo={key:0,class:"placeholder p-10 flex justify-center items-center text-center text-xl h-full"},lo={key:1,class:"p-10 flex justify-center items-center text-3xl"},no={class:"my-fleets__workshops h-full shrink-0 lg:max-w-[410px]"},io={class:"flex w-full items-end mb-2"},ao=pe(()=>e("div",null,[e("div",{class:"title leading-none text-2xl text-modal-title font-medium"}," My Workshops ")],-1)),ro={class:"ml-auto"},co={class:"bordered p-4 grid gap-y-2"},uo={key:0,class:"flex placeholder p-10 justify-center items-center text-center text-xl h-full"},ho={key:1,class:"p-10 flex justify-center items-center text-3xl"},po={__name:"MyFleets",setup(t){const s=le(),r=ge(),i=z(),o=()=>{M.show({component:Fs,bind:{onSave:async a=>{await s.createWorkshop(a),M.hideAll()}}})},c=()=>{M.show({component:Ot,bind:{ships:s.ships,shipClasses:s.shipClasses,onAdd:async a=>{await s.createOrUpdateUserShip(a),M.hideAll()}}})},m=a=>{M.show({component:cs,bind:{ship:a.ship,userShip:a,onSave:async v=>{await s.createOrUpdateUserShip(v),M.hideAll()},onDelete:async v=>{await s.deleteUserShip(v.id_user_ship),M.hideAll()}}})},b=a=>{r.push({name:"builder.workshop",params:{id_workshop:a.id_workshop}})},u=async a=>{se({title:`Really delete ${a.arcade?"arcade":"simulation"} workshop "${a.name}" ?`,message:"On a moral level, it's totally fine. Your ships will be fine, as well. But all fleet configurations will be gone. Proceed?",onConfirm:()=>{_(a)}})},_=async a=>{se({title:"For sure?",message:`Think of all the fun you and workshop "${a.name}" had together.`,onConfirm:()=>{h(a)}})},h=async a=>{se({title:"Last chance for real!",message:"Think of the children...",onConfirm:()=>{s.deleteWorkshop(a.id_workshop),i.info("Workshop delete successfully")}})},l=L(!1);return ce(()=>{const a=s.ships.length?Promise.resolve():s.loadShips(),v=s.userShips.length?Promise.resolve():s.loadUserShips(),p=s.shipClasses.length?Promise.resolve():s.loadShipClasses(),k=s.workshops.length?Promise.resolve():s.loadWorkshops();Promise.all([a,v,p,k]).then(()=>{l.value=!0})}),(a,v)=>(n(),$(de,null,{default:U(()=>[e("div",Ys,[e("div",Js,[e("div",Ks,[e("div",Qs,[e("div",Xs,[Zs,e("div",eo,[l.value?(n(),d("button",{key:0,class:"btn btn-blue btn-sm ml-4",onClick:c}," Add Ship ")):W("",!0)])]),e("div",to,[l.value?(n(),d(F,{key:0},[e("div",so,[(n(!0),d(F,null,B(f(s).userShips,p=>(n(),$(ie,{key:p.id_user_ship,userShip:p,showTags:!1,onClick:k=>m(p)},null,8,["userShip","onClick"]))),128))]),f(s).userShips.length?W("",!0):(n(),d("div",oo," There are no ships in your fleet. Create one. "))],64)):(n(),d("div",lo,[x(f(K),{class:"animate-spin"})]))])]),e("div",no,[e("div",io,[ao,e("div",ro,[l.value?(n(),d("button",{key:0,class:"btn btn-blue btn-sm ml-4",onClick:o}," Add Workshop ")):W("",!0)])]),e("div",co,[l.value?(n(),d(F,{key:0},[(n(!0),d(F,null,B(f(s).workshops,p=>(n(),$(Ts,{key:p.id_workshop,workshop:p,onDelete:u,onSelect:b},null,8,["workshop"]))),128)),f(s).workshops.length?W("",!0):(n(),d("div",uo," No workshops yet. Create one! "))],64)):(n(),d("div",ho,[x(f(K),{class:"animate-spin"})]))])])])])])]),_:1}))}},_o=D(po,[["__scopeId","data-v-307b12f5"]]),mo={class:"add-ship__filters flex gap-x-4 items-center mb-4"},fo=e("div",{class:"text-modal-title font-medium"},"Filter by name",-1),vo=e("div",{class:"text-modal-title font-medium"},"Filter by class",-1),bo={key:0,class:"pt-6"},yo={class:"add-ships__list flex flex-col w-full gap-y-2"},xo={key:0,class:"btn btn-sm btn-gray",disabled:""},go=["onClick"],So=["onClick"],ko={key:1,class:"btn btn-sm btn-gray",disabled:""},wo={__name:"UserShipSelectList",props:{userShips:{type:Array,required:!0},shipClasses:{type:Array,required:!0},busy:{type:Boolean,default:!1},energyLimit:{type:Number,default:null}},emits:["select","unselect"],setup(t,{emit:s}){const r=t,i=l=>{s("select",l)},o=l=>{s("unselect",l)},c=V({search:"",id_class:null}),m=C(()=>Object.values(c).some(l=>!!l)),b=()=>{c.search="",c.id_class=null},u=C(()=>r.energyLimit!==null),_=l=>u.value?l<=r.energyLimit:!0,h=C(()=>{let l=[...r.userShips];return c.search&&(l=l.filter(a=>a.ship.name.toLowerCase().includes(c.search.toLowerCase()))),c.id_class&&(l=l.filter(a=>a.ship.id_class===c.id_class)),l});return(l,a)=>{const v=j("VSelect");return n(),d(F,null,[e("div",mo,[e("div",null,[fo,T(e("input",{type:"text",class:"input input--search",placeholder:"Search by name...","onUpdate:modelValue":a[0]||(a[0]=p=>c.search=p)},null,512),[[E,c.search]])]),e("div",null,[vo,x(v,{options:t.shipClasses,reduce:p=>p.id_class,searchable:!0,clearable:!0,label:"name",modelValue:c.id_class,"onUpdate:modelValue":a[1]||(a[1]=p=>c.id_class=p)},null,8,["options","reduce","modelValue"])]),f(m)?(n(),d("div",bo,[e("button",{class:"btn btn-sm btn-red",onClick:b}," Clear filters ")])):W("",!0)]),e("div",yo,[(n(!0),d(F,null,B(f(h),p=>(n(),$(ie,{key:p.id_user_ship,userShip:p},{actions:U(()=>[t.busy?(n(),d("button",xo,[x(f(K),{class:"animate-spin"})])):p.selected?(n(),d("button",{key:1,class:"btn btn-sm btn-red",onClick:k=>o(p)}," Unselect ",8,go)):(n(),d(F,{key:2},[_(p.ship.energy)?(n(),d("button",{key:0,class:"btn btn-sm btn-green",onClick:k=>i(p)}," Select ",8,So)):(n(),d("button",ko," Not enough energy "))],64))]),_:2},1032,["userShip"]))),128))])],64)}}};const $o={__name:"SelectUserShipModal",props:{fleet:{type:Object,required:!0},userShips:{type:Object,required:!0},shipClasses:{type:Array,required:!0},busy:{type:Object,default:!1}},emits:["select","unselect"],setup(t,{emit:s}){const r=t,i=u=>{s("select",u)},o=u=>{s("unselect",u)},c=C(()=>r.busy.value),m=C(()=>r.userShips.value),b=C(()=>{var u,_;return((_=(u=r.fleet.value)==null?void 0:u.stats)==null?void 0:_.leadershipRemaining)||null});return(u,_)=>{const h=j("vue-final-modal");return n(),$(h,{classes:"modal-container","content-class":"w-full modal-content--lg"},{default:U(()=>[x(G,{class:"w-full","bg-class":"custom-bg"},{default:U(()=>[t.fleet.value?(n(),$(ue,{key:0,fleet:t.fleet.value,class:"bg-dark-bg-start/50 p-4"},null,8,["fleet"])):W("",!0),x(wo,{userShips:f(m),shipClasses:t.shipClasses,busy:f(c),energyLimit:f(b),onSelect:i,onUnselect:o},null,8,["userShips","shipClasses","busy","energyLimit"])]),_:1})]),_:1})}}};const _e=t=>(N("data-v-7083b809"),t=t(),P(),t),Co=["onSubmit"],Fo={class:"flex gap-x-3 justify-between"},Uo={class:"text-xl modal__title font-medium mb-6"},Ao={key:0},Io=["disabled"],Wo={class:"form-group"},Mo=_e(()=>e("label",null,"Fleet Name",-1)),qo={class:"form-group mb-10"},Lo=_e(()=>e("label",null,"Leadership Capacity",-1)),Do={key:0,class:"mb-2"},Vo={key:1,class:"select-list p-4 mb-8 flex flex-col gap-y-2"},jo=["onClick"],Bo={class:"form-group pt-4"},Oo=["disabled"],To={key:0},No={key:1},Po={__name:"FleetFormModal",props:{idWorkshop:{type:Number,required:!0},location:{type:Object,required:!0},fleet:{type:Object,default:null},onSave:{type:Function,required:!0},onDelete:{type:Function,required:!0},excludeSelected:{type:Boolean,default:!1},onSelectShip:{type:Function,required:!0},onUnselectShip:{type:Function,required:!0}},setup(t){const s=t,r=z(),i=le(),o=V({name:"",leadership:0}),c=V({name:"",leadership:""}),m=V({name:!1,leadership:!1}),b=L(!1),u=L(""),_=L(!1),h=L(!1),l=()=>{o.name?c.name="":c.name="Name is required",o.leadership?c.leadership="":c.leadership="Leadership is required",b.value=!Object.values(c).some(w=>!!w)},a=async()=>{var w,g,A;if(b.value){_.value=!0;try{await s.onSave(s.location.slug,{...ee(o),id_workshop_fleet:(w=s.fleet)==null?void 0:w.id_workshop_fleet})}catch(S){r.error(((A=(g=S.response)==null?void 0:g.data)==null?void 0:A.message)||S.message)}_.value=!1}},v=async w=>{_.value=!0;try{await s.onDelete(w)}catch(g){u.value=g.message}_.value=!1},p=async w=>{var g,A;h.value=!0;try{await s.onUnselectShip(s.fleet.id_workshop_fleet,w.id_user_ship)}catch(S){r.error(((A=(g=S.response)==null?void 0:g.data)==null?void 0:A.message)||S.message)}h.value=!1},k=async w=>{var g,A;h.value=!0;try{await s.onSelectShip(s.fleet.id_workshop_fleet,w.id_user_ship)}catch(S){r.error(((A=(g=S.response)==null?void 0:g.data)==null?void 0:A.message)||S.message)}h.value=!1},X=()=>{M.show({component:$o,bind:{fleet:J,userShips:me,shipClasses:re.value,busy:h,onSelect:k,onUnselect:p}})},J=C(()=>{var g;return(g=i.selectedFleets)==null?void 0:g.find(A=>{var S;return A.id_workshop_fleet===((S=s.fleet)==null?void 0:S.id_workshop_fleet)})}),ae=C(()=>{var w;return(w=i.selectedFleets)==null?void 0:w.reduce((g,A)=>[...g,...A.user_ships.map(S=>S.id_user_ship)],[])}),re=C(()=>i.shipClasses),me=C(()=>{var S,te;const w=(te=(S=J.value)==null?void 0:S.user_ships)==null?void 0:te.map(q=>q.id_user_ship);let g=i.userShips.map(q=>ee(q)).filter(q=>q.visible);s.excludeSelected&&(g=g.filter(q=>w.includes(q.id_user_ship)?!0:!ae.value.includes(q.id_user_ship)));const A=g.map(q=>({...q,selected:ae.value.includes(q.id_user_ship)}));return Se(A,w),A});return Z(o,l,{immediate:!0}),Z(J,w=>{w&&(o.name=w.name,o.leadership=w.leadership)},{immediate:!0}),(w,g)=>{const A=j("vue-final-modal");return n(),$(A,{classes:"modal-container","content-class":"w-full modal-content--xl"},{default:U(()=>[x(G,{class:"w-full","bg-class":"custom-bg"},{default:U(()=>[e("form",{action:"",class:"fleet-form",onSubmit:Q(a,["prevent"])},[e("div",Fo,[e("div",null,[e("h2",Uo,y(t.location.name),1)]),t.fleet?(n(),d("div",Ao,[e("button",{class:"btn btn-red btn-sm",type:"button",onClick:g[0]||(g[0]=S=>v(t.fleet.id_workshop_fleet)),disabled:_.value},[_.value?(n(),d(F,{key:0},[I(" Deleting... ")],64)):(n(),d(F,{key:1},[I(" Delete ")],64))],8,Io)])):W("",!0)]),e("div",Wo,[Mo,T(e("input",{type:"text",class:"form-control","onUpdate:modelValue":g[1]||(g[1]=S=>o.name=S)},null,512),[[E,o.name]]),x(oe,{error:c.name,dirty:m.name},null,8,["error","dirty"])]),e("div",qo,[Lo,T(e("input",{type:"text",class:"form-control","onUpdate:modelValue":g[2]||(g[2]=S=>o.leadership=S)},null,512),[[E,o.leadership]]),x(oe,{error:c.leadership,dirty:m.leadership},null,8,["error","dirty"])]),t.fleet?(n(),d("div",Do,[e("button",{type:"button",class:"btn btn-bright-blue btn-sm",onClick:X}," Add Ship ")])):W("",!0),t.fleet?(n(),d("div",Vo,[x(ue,{fleet:f(J),class:"mb-4"},null,8,["fleet"]),(n(!0),d(F,null,B(f(J).user_ships,S=>(n(),$(ie,{key:S.id_user_ship,userShip:S,shipClasses:f(re)},{actions:U(()=>[e("button",{class:"btn btn-sm btn-red",type:"button",onClick:te=>p(S)}," Unselect ",8,jo)]),_:2},1032,["userShip","shipClasses"]))),128))])):W("",!0),e("div",Bo,[e("button",{class:"btn btn-blue w-full block",disabled:!b.value||_.value,type:"submit"},[_.value?(n(),d("span",To,"Saving...")):(n(),d("span",No,"Save"))],8,Oo)])],40,Co)]),_:1})]),_:1})}}},Ro=D(Po,[["__scopeId","data-v-7083b809"]]),Eo={viewBox:"0 0 448 512",width:"1.2em",height:"1.2em"},Ho=e("path",{fill:"currentColor",d:"m257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"},null,-1),zo=[Ho];function Go(t,s){return n(),d("svg",Eo,zo)}const Yo={name:"fa-solid-arrow-left",render:Go},Jo={class:"share-bar"},Ko={class:"flex rounded dark-border-end border-1 overflow-hidden items-stretch"},Qo=["value"],Xo={__name:"ShareWorkshop",props:{id_workshop:{type:[String,Number],required:!0}},setup(t){const s=t,r=L(null),i=z(),o=C(()=>window.location.origin+"/share/"+s.id_workshop),{copy:c,isSupported:m}=ke(),b=async()=>{await c(r),u()},u=we.debounce(()=>{m.value&&i.success("Copied to clipboard")},750),_=l=>{b(),l.target.select(),l.target.setSelectionRange(0,9999)},h=()=>{_({target:r.value})};return(l,a)=>(n(),d("div",Jo,[e("div",Ko,[e("div",{class:"bg-box-gray text-box-gray-text flex justify-center items-center px-3 cursor-pointer",onClick:h},[x(f(Te))]),e("div",null,[e("input",{ref_key:"inputRef",ref:r,type:"text",class:"input-clean",readonly:"",value:f(o),onFocus:_},null,40,Qo)])])]))}};const Zo={class:"workshop max-w-6xl flex flex-col justify-center mx-auto pt-6"},el={class:"workshop__heading mb-8"},tl={class:"mb-2"},sl={class:"flex items-center"},ol={class:"text-2xl font-medium mb-2 modal__title"},ll={class:"font-xl text-white"},nl={class:"ml-auto"},il={class:"workshop__content w-full text-modal-text"},al={class:"grid gap-x-4 gap-y-8 w-full"},rl={__name:"Workshop",setup(t){const s=$e(),r=Ce.getFleetLocations(),i=le(),o=L(!1),c=z(),m=(h,l)=>{var a;M.show({component:Ro,bind:{idWorkshop:(a=u.value)==null?void 0:a.id_workshop,location:h,fleet:l,excludeSelected:!u.value.arcade,onSave:async(v,p)=>{var X;const k=await i.createOrUpdateFleet((X=u.value)==null?void 0:X.id_workshop,v,p);p.id_workshop_fleet||(M.hideAll(),m(h,k)),c.success("Fleet saved successfully")},onDelete:async v=>{var p;await i.deleteFleet((p=u.value)==null?void 0:p.id_workshop,v),M.hideAll()},onSelectShip:(v,p)=>{var k;return i.addUserShipToFleet((k=u.value)==null?void 0:k.id_workshop,v,p)},onUnselectShip:(v,p)=>{var k;return i.removeUserShipFromFleet((k=u.value)==null?void 0:k.id_workshop,v,p)}}})},b=(h,l)=>{var a;return i.setFleetFlagship((a=u.value)==null?void 0:a.id_workshop,h.id_workshop_fleet,l.id_user_ship).catch(v=>{var p,k;console.warn("Error setting flagship",v),c.error(((k=(p=v.response)==null?void 0:p.data)==null?void 0:k.message)||v.message)})},u=C(()=>i.workshops.find(h=>h.id_workshop===parseInt(s.params.id_workshop))),_=C(()=>(console.log("computing fleet locations"),r.map(h=>{var a,v;const l=(a=i.selectedFleets)==null?void 0:a.find(p=>p.location===h.slug);return{...h,statTotals:l&&((v=i.selectedFleetsStats)==null?void 0:v[l.id_workshop_fleet])||null,fleet:l}})));return ce(async()=>{const h=i.ships.length?Promise.resolve():i.loadShips(),l=i.userShips.length?Promise.resolve():i.loadUserShips(),a=i.shipClasses.length?Promise.resolve():i.loadShipClasses(),v=i.workshops.length?Promise.resolve():i.loadWorkshops();await Promise.all([h,l,a,v]).then(()=>{o.value=!0}),i.setSelectedWorkshopId(s.params.id_workshop)}),(h,l)=>{const a=j("router-link");return n(),$(de,null,{default:U(()=>{var v,p;return[e("div",Zo,[e("div",el,[e("div",tl,[x(a,{class:"text-grow-green-text-alt flex gap-x-2 items-center",to:{name:"builder.fleets"}},{default:U(()=>[x(f(Yo)),I(" Back to Fleets ")]),_:1},8,["to"])]),e("div",sl,[e("div",null,[e("h1",ol,y(((v=f(u))==null?void 0:v.name)||"Workshop"),1),e("p",ll,y((p=f(u))!=null&&p.arcade?"Arcade":"Simulation"),1)]),e("div",nl,[x(Xo,{id_workshop:f(s).params.id_workshop},null,8,["id_workshop"])])])]),e("div",il,[e("div",al,[(n(!0),d(F,null,B(f(_),k=>(n(),$(Ne,{key:k.slug,location:k.slug,locationName:k.name,fleet:k.fleet,statTotals:k.statTotals,onSelect:m,onFlagship:b},null,8,["location","locationName","fleet","statTotals"]))),128))])])])]}),_:1})}}},cl=D(rl,[["__scopeId","data-v-e934fdc9"]]),dl=[{path:"/",component:_o,name:"builder.fleets"},{path:"/workshop/:id_workshop",component:cl,name:"builder.workshop"}],ul=Fe({history:Ue("/builder"),routes:dl}),O=Ae(Ve),hl=Ie();O.use(hl);O.component("VSelect",We);O.component("ConfirmModal",Gs);O.use(ul);O.use(Me);O.directive("tooltip",qe);O.use(Le,{position:De.TOP_RIGHT,timeout:3e3});O.mount("#app");Pe();

import{u as ue,B as fe,o as n,f as h,e as g,a as s,t as x,n as I,d as P,S as F,_ as V,T as re,r as ve,c as U,w as z,b as C,U as q,m as R,F as L,y as D,V as ye,g as k,E as O,W as ge,X as be,Y as le,Z as ne,D as $,a0 as J,a1 as Y,a2 as me,a3 as xe,a4 as oe,a5 as $e,a6 as Ae,a7 as we,a8 as Se,a9 as ke,aa as Te,ab as Ce,ac as Ee,s as Ie,k as N,ad as S,ae as B,af as de,ag as ee,ah as te,ai as Fe,aj as Ne,ak as Le}from"./index-935aeafb.js";const Ue={key:0,class:"bg-indigo-900 text-indigo-200 px-3 py-1 md:flex gap-x-2"},Be={class:""},Pe=s("div",{class:"ml-auto"},[s("a",{href:"/dashboard",class:"text-indigo-100 hover:text-white"}," Admin panel ")],-1),Oe={__name:"UserLayout",setup(e){const t=ue();return fe(()=>{t.user||t.refresh()}),(i,a)=>(n(),h("div",{class:F(["layout layout--user",{"has-admin-bar":g(t).isAdmin}])},[g(t).isAdmin?(n(),h("div",Ue,[s("div",Be," Welcome, "+x(g(t).user.name)+". Hail, o' great admin! ",1),Pe])):I("",!0),P(i.$slots,"default")],2))}};const Me={class:"content-box p-3"},ze=re('<div class="content-box__top flex" data-v-2cc5bd04><div class="shrink" data-v-2cc5bd04><div class="content-box__tick modal__tick" data-v-2cc5bd04></div></div><div class="grow" data-v-2cc5bd04></div><div class="shrink" data-v-2cc5bd04><div class="content-box__tick modal__tick" data-v-2cc5bd04></div></div></div>',1),Re=re('<div class="content-box__bottom flex" data-v-2cc5bd04><div class="shrink" data-v-2cc5bd04><div class="content-box__tick modal__tick" data-v-2cc5bd04></div></div><div class="grow" data-v-2cc5bd04></div><div class="shrink" data-v-2cc5bd04><div class="content-box__tick modal__tick" data-v-2cc5bd04></div></div></div>',1),Ve={__name:"ContentBox",props:{bgClass:{type:String,default:"bg-modal-content/25"}},setup(e){return(t,i)=>(n(),h("div",Me,[ze,s("div",{class:F(["content-box__body modal-border py-3 px-3 text-modal-text m-4",[e.bgClass]])},[P(t.$slots,"default",{},void 0,!0)],2),Re]))}},xi=V(Ve,[["__scopeId","data-v-2cc5bd04"]]);const Ye={class:"view view space-bg"},De={__name:"BuilderLayout",setup(e){return(t,i)=>{const a=ve("modals-container");return n(),U(Oe,{class:"themed"},{default:z(()=>[s("div",Ye,[P(t.$slots,"default",{},void 0,!0)]),C(a)]),_:3})}}},$i=V(De,[["__scopeId","data-v-4a8b88db"]]),je={viewBox:"0 0 448 512",width:"1.2em",height:"1.2em"},qe=s("path",{fill:"currentColor",d:"M400 256H152V152.9c0-39.6 31.7-72.5 71.3-72.9c40-.4 72.7 32.1 72.7 72v16c0 13.3 10.7 24 24 24h32c13.3 0 24-10.7 24-24v-16C376 68 307.5-.3 223.5 0C139.5.3 72 69.5 72 153.5V256H48c-26.5 0-48 21.5-48 48v160c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V304c0-26.5-21.5-48-48-48zM264 408c0 22.1-17.9 40-40 40s-40-17.9-40-40v-48c0-22.1 17.9-40 40-40s40 17.9 40 40v48z"},null,-1),We=[qe];function He(e,t){return n(),h("svg",je,We)}const Ge={name:"fa-solid-unlock-alt",render:He},Ke={viewBox:"0 0 640 512",width:"1.2em",height:"1.2em"},Qe=s("path",{fill:"currentColor",d:"M544 160v64h32v64h-32v64H64V160h480m16-64H48c-26.51 0-48 21.49-48 48v224c0 26.51 21.49 48 48 48h512c26.51 0 48-21.49 48-48v-16h8c13.255 0 24-10.745 24-24V184c0-13.255-10.745-24-24-24h-8v-16c0-26.51-21.49-48-48-48zm-144 96H96v128h320V192z"},null,-1),Xe=[Qe];function Ze(e,t){return n(),h("svg",Ke,Xe)}const Je={name:"fa-solid-battery-three-quarters",render:Ze};const et={__name:"Chips",props:{total:{type:Number,required:!0},chipLevel:{type:Number,required:!0},height:{type:String,default:"12px"}},setup(e){return(t,i)=>{const a=q("tooltip");return R((n(),h("div",{class:"chips flex gap-x-[2px] cursor-pointer",style:ye({"--height":e.height})},[(n(!0),h(L,null,D(e.total,o=>(n(),h("div",{class:F(["chip",{"chip--unlocked":o<=e.chipLevel}]),key:o},null,2))),128))],4)),[[a,"Chip level: "+e.chipLevel]])}}},tt=V(et,[["__scopeId","data-v-5a957f65"]]),st={class:"ship-fleet-item item"},it={class:"ship-box__content"},at={class:"ship-box__content-bg p-2"},lt={class:"flex w-full gap-x-3"},nt={class:"flex gap-x-2 text-xs items-center"},ot={class:"flex gap-x-[2px] items-center"},ct={class:"flex gap-x-2 items-center font-medium leading-none"},rt={class:"italic text-xs"},dt=s("div",null,null,-1),ht={class:"item__actions ml-auto"},_t={__name:"ShipFleetLine",props:{userShip:{type:Object,required:!0}},setup(e){return(t,i)=>(n(),h("div",st,[s("div",{class:F(["ship ship-box",["ship-box--"+e.userShip.ship.ship_level.name.toLowerCase()]])},[s("div",it,[s("div",at,[s("div",lt,[s("div",null,[s("div",nt,[s("div",null,x(e.userShip.ship.ship_class.name),1),s("div",ot,[s("div",null,[C(g(Je))]),s("div",null,x(e.userShip.ship.energy),1)]),s("div",null,[C(tt,{total:e.userShip.ship.chipCount,chipLevel:e.userShip.chip_level,height:"8px"},null,8,["total","chipLevel"])])]),s("div",ct,[s("div",null,x(e.userShip.ship.name),1),s("div",rt,x(e.userShip.name),1)])]),dt,s("div",ht,[P(t.$slots,"actions")])]),P(t.$slots,"footer")])])],2)]))}},pt={key:0,class:"fleet__top-stats flex gap-x-2 justify-between items-center mb-4 leading-none"},ut={class:"fleet__leadership"},ft=s("div",{class:"text-xs text-text-blue"},"Leadership",-1),vt={class:"text-center"},yt={class:"fleet__ship-count"},gt=s("div",{class:"text-center text-xs text-text-blue"},"Ships",-1),bt={class:"text-center"},mt={__name:"FleetShipStats",props:{fleet:{type:Object,required:!0}},setup(e){return(t,i)=>{const a=q("tooltip");return e.fleet.stats?(n(),h("div",pt,[s("div",ut,[ft,s("div",vt,[s("span",null,[s("b",null,x(e.fleet.stats.leadershipUsed),1)]),k(" / "),s("span",null,[s("b",null,x(e.fleet.leadership),1)]),e.fleet.stats.leadershipRemaining!==0?R((n(),h("span",{key:0,class:F(["font-bold cursor-pointer",{"text-grow-green-text-alt":e.fleet.stats.leadershipRemaining>0,"text-btn-red-border":e.fleet.stats.leadershipRemaining<0}])},[k(" ("+x(e.fleet.stats.leadershipRemaining>0?"+":"")+x(e.fleet.stats.leadershipRemaining)+") ",1)],2)),[[a,e.fleet.stats.leadershipRemaining>0?"Leader remaining":"Leadership exceeded"]]):I("",!0)])]),s("div",yt,[gt,s("div",bt,[s("b",null,x(e.fleet.stats.shipCount)+" / 9 ",1)])])])):I("",!0)}}},xt={viewBox:"0 0 512 512",width:"1.2em",height:"1.2em"},$t=s("path",{fill:"currentColor",d:"M349.565 98.783C295.978 98.783 251.721 64 184.348 64c-24.955 0-47.309 4.384-68.045 12.013a55.947 55.947 0 0 0 3.586-23.562C118.117 24.015 94.806 1.206 66.338.048C34.345-1.254 8 24.296 8 56c0 19.026 9.497 35.825 24 45.945V488c0 13.255 10.745 24 24 24h16c13.255 0 24-10.745 24-24v-94.4c28.311-12.064 63.582-22.122 114.435-22.122c53.588 0 97.844 34.783 165.217 34.783c48.169 0 86.667-16.294 122.505-40.858C506.84 359.452 512 349.571 512 339.045v-243.1c0-23.393-24.269-38.87-45.485-29.016c-34.338 15.948-76.454 31.854-116.95 31.854z"},null,-1),At=[$t];function wt(e,t){return n(),h("svg",xt,At)}const ie={name:"fa-solid-flag",render:wt},St={viewBox:"0 0 512 512",width:"1.2em",height:"1.2em"},kt=s("path",{fill:"currentColor",d:"M416 48v416c0 26.51-21.49 48-48 48H144c-26.51 0-48-21.49-48-48V48c0-26.51 21.49-48 48-48h224c26.51 0 48 21.49 48 48zm96 58v12a6 6 0 0 1-6 6h-18v6a6 6 0 0 1-6 6h-42V88h42a6 6 0 0 1 6 6v6h18a6 6 0 0 1 6 6zm0 96v12a6 6 0 0 1-6 6h-18v6a6 6 0 0 1-6 6h-42v-48h42a6 6 0 0 1 6 6v6h18a6 6 0 0 1 6 6zm0 96v12a6 6 0 0 1-6 6h-18v6a6 6 0 0 1-6 6h-42v-48h42a6 6 0 0 1 6 6v6h18a6 6 0 0 1 6 6zm0 96v12a6 6 0 0 1-6 6h-18v6a6 6 0 0 1-6 6h-42v-48h42a6 6 0 0 1 6 6v6h18a6 6 0 0 1 6 6zM30 376h42v48H30a6 6 0 0 1-6-6v-6H6a6 6 0 0 1-6-6v-12a6 6 0 0 1 6-6h18v-6a6 6 0 0 1 6-6zm0-96h42v48H30a6 6 0 0 1-6-6v-6H6a6 6 0 0 1-6-6v-12a6 6 0 0 1 6-6h18v-6a6 6 0 0 1 6-6zm0-96h42v48H30a6 6 0 0 1-6-6v-6H6a6 6 0 0 1-6-6v-12a6 6 0 0 1 6-6h18v-6a6 6 0 0 1 6-6zm0-96h42v48H30a6 6 0 0 1-6-6v-6H6a6 6 0 0 1-6-6v-12a6 6 0 0 1 6-6h18v-6a6 6 0 0 1 6-6z"},null,-1),Tt=[kt];function Ct(e,t){return n(),h("svg",St,Tt)}const Et={name:"fa-solid-microchip",render:Ct},It={viewBox:"0 0 512 512",width:"1.2em",height:"1.2em"},Ft=s("path",{fill:"currentColor",d:"M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46s46-20.595 46-46s-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},null,-1),Nt=[Ft];function Lt(e,t){return n(),h("svg",It,Nt)}const Ut={name:"fa-solid-exclamation-circle",render:Lt},Bt={viewBox:"0 0 512 512",width:"1.2em",height:"1.2em"},Pt=s("path",{fill:"currentColor",d:"M504 256c0 137-111 248-248 248S8 393 8 256S119 8 256 8s248 111 248 248zM273 369.9l135.5-135.5c9.4-9.4 9.4-24.6 0-33.9l-17-17c-9.4-9.4-24.6-9.4-33.9 0L256 285.1L154.4 183.5c-9.4-9.4-24.6-9.4-33.9 0l-17 17c-9.4 9.4-9.4 24.6 0 33.9L239 369.9c9.4 9.4 24.6 9.4 34 0z"},null,-1),Ot=[Pt];function Mt(e,t){return n(),h("svg",Bt,Ot)}const zt={name:"fa-solid-chevron-circle-down",render:Mt},Rt={viewBox:"0 0 448 512",width:"1.2em",height:"1.2em"},Vt=s("path",{fill:"currentColor",d:"M352 320c-22.608 0-43.387 7.819-59.79 20.895l-102.486-64.054a96.551 96.551 0 0 0 0-41.683l102.486-64.054C308.613 184.181 329.392 192 352 192c53.019 0 96-42.981 96-96S405.019 0 352 0s-96 42.981-96 96c0 7.158.79 14.13 2.276 20.841L155.79 180.895C139.387 167.819 118.608 160 96 160c-53.019 0-96 42.981-96 96s42.981 96 96 96c22.608 0 43.387-7.819 59.79-20.895l102.486 64.054A96.301 96.301 0 0 0 256 416c0 53.019 42.981 96 96 96s96-42.981 96-96s-42.981-96-96-96z"},null,-1),Yt=[Vt];function Dt(e,t){return n(),h("svg",Rt,Yt)}const jt={name:"fa-solid-share-alt",render:Dt};const qt={class:"ability-tag__icon cursor-pointer"},Wt={class:"ability-tag__text"},Ht={class:"ability-tag__text__name"},Gt={class:"ability-tag__badges flex gap-x-[2px] text-xs"},Kt={key:0,class:"cursor-pointer"},Qt={key:1,class:"cursor-pointer"},Xt={key:2,class:"ability-tag__boost cursor-pointer"},Zt={__name:"AbilityTag",props:{parsedAbility:{type:Object,required:!0}},setup(e){const t=e,i=O(()=>t.parsedAbility.ability.location.includes("flagship_")?ie:t.parsedAbility.ability.location.includes("chip_")?Et:zt);return(a,o)=>{const d=q("tooltip");return n(),h("div",{class:F(["ability-tag flex gap-x-[3px] items-center text-xs leading-none",[`ability-tag--${e.parsedAbility.extra.affectType}`]])},[R((n(),h("div",qt,[(n(),U(ge(g(i))))])),[[d,e.parsedAbility.extra.fullDescription]]),s("div",Wt,[s("div",Ht,[k(x(e.parsedAbility.extra.abilityTypeCategory)+" ",1),e.parsedAbility.extra.amountIsFormula?(n(),h(L,{key:0},[k(" calc(x) ")],64)):(n(),h(L,{key:1},[k(x(e.parsedAbility.extra.amount),1)],64))])]),s("div",Gt,[e.parsedAbility.extra.hasConditions?R((n(),h("div",Kt,[C(g(Ut))])),[[d,`Condition: ${e.parsedAbility.extra.conditionsDescription}`]]):I("",!0),e.parsedAbility.extra.hasQualifiers?R((n(),h("div",Qt,[C(g(be))])),[[d,e.parsedAbility.extra.abilityQualifiiers]]):I("",!0),e.parsedAbility.ability.applies_to_fleet&&!e.parsedAbility.ability.location.includes("flagship_")?R((n(),h("div",Xt,[C(g(jt))])),[[d,"Boosts Fleet"]]):I("",!0)])],2)}}},he=V(Zt,[["__scopeId","data-v-3cc3fe04"]]),Jt={viewBox:"0 0 512 512",width:"1.2em",height:"1.2em"},es=s("path",{fill:"currentColor",d:"M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256S119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"},null,-1),ts=[es];function ss(e,t){return n(),h("svg",Jt,ts)}const is={name:"fa-solid-check-circle",render:ss},as={viewBox:"0 0 512 512",width:"1.2em",height:"1.2em"},ls=s("path",{fill:"currentColor",d:"M256 8C119 8 8 119 8 256s111 248 248 248s248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65l-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7l65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"},null,-1),ns=[ls];function os(e,t){return n(),h("svg",as,ns)}const cs={name:"fa-solid-times-circle",render:os},rs={class:"flex items-center gap-x-3"},ds={class:"ability__from flex gap-x-2 items-start"},hs={class:"shrink"},_s={class:"text-sm italic pl-2"},ps={class:"grow"},us={class:"ability__matches"},fs={class:"flex gap-x-3 items-start"},vs=s("div",{class:"text-xs text-modal-text"},"Applies to:",-1),ys={key:1,class:"flex flex-wrap gap-2"},gs={class:"pl-2 text-white italic text-xs"},bs={key:2},ms={__name:"FleetParsedAbilityLine",props:{fleetUserShips:{type:Array,required:!0},parsedFleetAbility:{type:Object,required:!0}},setup(e){const t=e,i=O(()=>t.parsedFleetAbility.hasConditions?t.parsedFleetAbility.meetsConditions:!0),a=O(()=>{const o=t.parsedFleetAbility,d=[];return t.fleetUserShips.forEach(l=>{o.hasQualifiers&&o.ability.for_class_ids.length&&o.ability.for_class_ids.includes(l.ship.ship_class.id_class)&&d.push({id_user_ship:l.id_user_ship,id_ship:l.ship.id_ship,name:l.ship.name,nickname:l.name,ship_class:l.ship.ship_class.name})}),d.length&&d.length!==t.fleetUserShips.length?d:null});return(o,d)=>{var l;return n(),h("div",{class:F(["fleet-ability-line ability",{"ability--applied":g(i)}])},[s("div",rs,[s("div",null,[g(i)?(n(),U(g(is),{key:0,class:"text-grow-green-text-alt"})):(n(),U(g(cs),{key:1,class:"text-btn-red-border"}))]),s("div",null,[s("div",ds,[s("div",hs,[k(x(e.parsedFleetAbility.source.name)+" ",1),s("div",_s,x(e.parsedFleetAbility.source.nickname),1)]),s("div",ps,[C(he,{parsedAbility:e.parsedFleetAbility},null,8,["parsedAbility"])])]),s("div",us,[s("div",fs,[vs,s("div",null,[g(a)===null?(n(),h(L,{key:0},[k(" All ships in fleet ")],64)):(l=g(a))!=null&&l.length?(n(),h("div",ys,[(n(!0),h(L,null,D(g(a),(f,_)=>(n(),h("div",{key:`${f.id_user_ship}-${_}`},[k(x(f.name)+" ",1),s("span",gs,x(f.nickname),1)]))),128))])):(n(),h("div",bs,"Applies to no ships"))])])])])])],2)}}},xs={class:"fleet-ability-lines flex flex-col gap-y-3"},$s={__name:"FleetParsedAbilityStats",props:{fleet:{type:Object,required:!0},parsedAbilities:{type:Object,required:!0}},setup(e){return(t,i)=>(n(),h("div",xs,[(n(!0),h(L,null,D(e.parsedAbilities,a=>(n(),U(ms,{parsedFleetAbility:a,fleetUserShips:e.fleet.user_ships,key:a.ability.id_ability},null,8,["parsedFleetAbility","fleetUserShips"]))),128))]))}},As={viewBox:"0 0 320 512",width:"1.2em",height:"1.2em"},ws=s("path",{fill:"currentColor",d:"M31.3 192h257.3c17.8 0 26.7 21.5 14.1 34.1L174.1 354.8c-7.8 7.8-20.5 7.8-28.3 0L17.2 226.1C4.6 213.5 13.5 192 31.3 192z"},null,-1),Ss=[ws];function ks(e,t){return n(),h("svg",As,Ss)}const Ts={name:"fa-solid-caret-down",render:ks};const Cs={class:"accordion__header mb-2"},Es={class:"ml-auto"},Is={key:0,class:"accordion__body p-4"},Fs={__name:"Accordion",props:{name:{type:String,required:!0},modelValue:{type:String,default:"",required:!0}},emits:["update:modelValue"],setup(e,{emit:t}){const i=e,a=()=>{t("update:modelValue",i.name)},o=()=>{t("update:modelValue","")},d=()=>{l.value?o():a()},l=O(()=>i.modelValue===i.name);return(f,_)=>(n(),h("div",{class:F(["accordion mb-4",{"accordion--open":g(l)}])},[s("div",Cs,[P(f.$slots,"header",le(ne({toggle:d,open:a,close:o,isOpen:g(l)})),()=>[s("div",{class:"flex w-full py-2 px-4 border border-dark-border-start rounded cursor-pointer text-text-blue accordion__toggle",onClick:d},[s("div",null,[P(f.$slots,"title",{},()=>[k(" Title here ")],!0)]),s("div",Es,[C(g(Ts),{class:F({"rotate-90":!g(l)})},null,8,["class"])])])],!0)]),g(l)?(n(),h("div",Is,[s("div",null,[P(f.$slots,"body",le(ne({toggle:d,open:a,close:o,isOpen:g(l)})),void 0,!0)])])):I("",!0)],2))}},ce=V(Fs,[["__scopeId","data-v-9fcaaa54"]]),Ns=(e,t)=>{let i=!0;return e.ability.for_class_ids.length&&(i=e.ability.for_class_ids.includes(t.ship.ship_class.id_class)),i&&!e.meetsConditions&&(i=!1),i},Ls=e=>{const t=e.ability,i=[];t.duration_type&&i.push(`duration--${t.duration_type}-${t.duration}`),t.repeat_type&&i.push(`repeat--${t.repeat_type}-${t.repeat}`),t.variants.length&&i.push(["variant",[...t.variants]]),t.for_class_ids.length&&i.push(["for_class",[...t.for_class_ids]]),t.target_class_ids.length&&i.push(["target_class",[...t.target_class_ids]]),t.weapon_classes.length&&i.push(["weapon_class",[...t.weapon_classes]]),t.weapon_sizes.length&&i.push(["weapon_size",[...t.weapon_sizes]]);const a=(o,d)=>{if(!d.length)return o;const l=d.shift();if(Array.isArray(l)){const[f,_]=l;o.length?o=o.reduce((p,b)=>(_.forEach(m=>{p.push(b+"|"+f+"--"+m)}),p),[]):_.forEach(p=>{o.push(f+"--"+p)})}else typeof l=="string"&&(o.length?o=o.map(f=>f+"|"+l):o.push(l));return a(o,d)};return a([],i.length?i:["all"])},Us=(e,t)=>{if(e.ability.type===$.ABILITY_TYPES.INCREASE_WEAPON_DAMAGE){let i=t.ship.slotStrengths.weapon.total;return e.ability.weapon_sizes.length&&(i=e.ability.weapon_sizes.reduce((a,o)=>a+t.ship.slotStrengths.weapon[o],0)),i}else if(e.ability_type===$.ABILITY_TYPES.REDUCE_DAMAGE&&(!e.ability.variants.length||e.ability.variants.includes($.RESISTANCE_TYPES.ARMOR)))return t.ship.slotStrengths.armor.total;return 1},Bs=(e,t,i,a)=>{const o=e.ability;let d=[],l=[],f=[];if(o.target_class_ids.length){const[,_]=a.match(/target_class--(\d+)/);d=[parseInt(_)]}if(o.for_class_ids.length){const[,_]=a.match(/for_class--(\d+)/);f=[parseInt(_)]}if(o.variants.length){const[,_]=a.match(/variant--([a-z]+)/);l=[parseInt(_)]}return{source:{ability:e.ability,amount:i,id_user_ship:e.userShip.id_user_ship,slug:a},target:{id_user_ship:t.id_user_ship},strength:Us(e,t),variants:l,target_class_ids:d,for_class_ids:f}},se=(e,t,i)=>{const a=t.split("."),o=a.pop();let d=e;a.forEach(l=>{d[l]||(d[l]={}),d=d[l]}),d[o]||(d[o]=i)},Ps=(e,t,i,a,o,d)=>{const l=e.ability,f=[$.AMOUNT_TYPES.NUMBER,$.AMOUNT_TYPES.PERCENT,$.AMOUNT_TYPES.SECONDS,$.AMOUNT_TYPES.ATTACKS];l.amounts.forEach(_=>{se(a,`${l.type}.${i}.${_.type}`,[]),se(o,`${t.id_user_ship}.${l.type}.${i}.${_.type}`,[]),se(d,`${l.id_ability}.${i}.${_.type}`);const p=Bs(e,t,_,i);f.includes(_.type)?(p.value=parseFloat(_.value),a[l.type][i][_.type].push(p),o[t.id_user_ship][l.type][i][_.type].push(p),d[l.id_ability][i][_.type]=p):_.type===$.AMOUNT_TYPES.FORMULA?(p.value=_,a[l.type][i][_.type].push(p),o[t.id_user_ship][l.type][i][_.type].push(p),d[l.id_ability][i][_.type]=p):console.warn("Unknown amount type",_.type,_)})},Os=e=>{const t={},i={},a={};return e.parsedAbilities.forEach(o=>{e.user_ships.forEach(d=>{if(!Ns(o,d))return!1;Ls(o).forEach(_=>{Ps(o,d,_,t,i,a)})})}),{shipStats:i,totalStats:t,abilityStats:a}},Ms=e=>e.reduce((t,i)=>{const{totalStats:a,shipStats:o,abilityStats:d}=Os(i);return t[i.id_workshop_fleet]={totalStats:a,shipStats:o,abilityStats:d},t},{}),zs=(e,t)=>{const i=$.getVariantsByAbilityType(),a=[];return Object.entries(t).forEach(([o,d])=>{Object.entries(d).forEach(([l,f])=>{Object.entries(f).forEach(([_,p])=>{if(!(p&&p.length))return console.log("no arr",o,l,_,p);const b=p.shift(),m=[b.target.id_user_ship],E=[b.source.ability.id_ability];p.forEach(T=>{m.includes(T.target.id_user_ship)||m.push(T.target.id_user_ship),E.includes(T.source.ability.id_ability)||E.push(T.source.ability.id_ability)}),b.isVariantType=!!i[o],b.target=m,b.amountType=_,b.abilityType=o,b.slug=l,[$.AMOUNT_TYPES.NUMBER,$.AMOUNT_TYPES.PERCENT,$.AMOUNT_TYPES.SECONDS,$.AMOUNT_TYPES.ATTACKS].includes(_)?(p.forEach(T=>{b.value+=T.value,b.strength+=T.strength}),b.value/=m.length,b.strength/=E.length):_===$.AMOUNT_TYPES.FORMULA&&(b.values=[b.value],p.forEach(T=>{b.values.push(T.value)})),a.push(b)})})}),a},Rs=$.getAbilityTypes(),Vs=(e,t,{shipClasses:i})=>{const a=t.source.ability,o=Rs.find(M=>M.slug===a.type).name,d={default:"{abilityName}",[$.ABILITY_TYPES.INCREASE_WEAPON_DAMAGE]:"Increase {variants} Weapon Damage",[$.ABILITY_TYPES.REDUCE_DAMAGE]:"Reduce {variants} Damage",[$.ABILITY_TYPES.INCREASE_RESISTENCE]:"Increase {variants} Resistance",[$.ABILITY_TYPES.INCREASE_PENETRATION]:"Increase {variants} Penetration"};let l;if(t.isVariantType){const M=a.variants.length?J(t.variants):"All";l=Y(d[a.type],{abilityName:o,variants:M})}else l=Y(d.default,{abilityName:o});const f=a.for_class_ids.length?`${t.target.length} `+J(me(t.for_class_ids,{shipClasses:i})):xe("ship",t.target.length,!0),_=Y("of {ships}",{ships:f}),p={default:"by {parsedAmount}",[$.ABILITY_TYPES.INCREASE_ATTACK_SPEED]:"by {parsedAmount}",[$.ABILITY_TYPES.EXTRA_ATTACK]:"does {parsedAmount} damage"};let b;t.amountType===$.AMOUNT_TYPES.FORMULA?b=J(t.values.map(M=>oe(a,M))):b=oe(a,{type:t.amountType,value:$e(t.value)});const m=Y(p[t.amountType]||p.default,{parsedAmount:b});let E="";t.strength>t.target.length&&(E=Y("(affecting {strength} strength)",{strength:t.strength}));let T="";a.target_class_ids.length&&(T=Ae({...a,target_class_ids:t.target_class_ids},{shipClasses:i}));const W=we(a),H=Se(a),K=Y("{title} {shipCount} {amount} {strength} {against} {duration} {repeat}",{title:l,shipCount:_,amount:m,strength:E,against:T,duration:W,repeat:H}).replace(/\s{2,}/gm," ").trim(),Q=ke(a),X=Te(a),Z=Ce(a);return{description:K,category:Q,affectType:X,affectTypeName:Z}},Ys=Ee("builder",()=>{const e=Ie(),t=N([]),i=N(!1),a=N([]),o=N([]),d=N(!1),l=N([]),f=N(!1),_=N(null),p=N([]),b=r=>(m(r.ship),Fe(r,{shipClasses:B(a.value)}),r),m=r=>(Ne(r),r.chipCount=Le(r),r),E=r=>{_.value=r,p.value=[],ae(r)},T=O(()=>p.value.reduce((r,u)=>(r[u.id_workshop_fleet]=u.parsedAbilities,r),{})),W=O(()=>Ms(p.value)),H=async()=>{i.value=!0,await S.get("data/ships").then(r=>r.data.rows.map(m)).then(r=>{t.value=r}),i.value=!1},G=async()=>S.get("data/ships/classes").then(r=>{a.value=r.data.rows}),K=async()=>{d.value=!0,await S.get("user/ships").then(r=>r.data.rows.map(b)).then(r=>{o.value=r}),d.value=!1},Q=async()=>{f.value=!0,await S.get("user/workshops").then(r=>{l.value=r.data.rows.map(u=>({...u}))}),f.value=!1},X=async r=>{var u,y;try{const c=await S.post("user/ships",r),v=o.value,A=c.data.row;if(b(A),r.id_user_ship){const w=v.findIndex(pe=>pe.id_user_ship===r.id_user_ship);v.splice(w,1,A)}else v.push(A);return!0}catch(c){return e.error("Error saving ship: "+(((y=(u=c.response)==null?void 0:u.data)==null?void 0:y.message)||c.message)),!1}},Z=async r=>{var u,y;try{await S.delete("user/ships/"+r);const c=[...o.value].map(A=>B(A)),v=c.findIndex(A=>A.id_user_ship===r);return c.splice(v,1),o.value=c,!0}catch(c){return e.error("Error deleting ship: "+(((y=(u=c.response)==null?void 0:u.data)==null?void 0:y.message)||c.message)),!1}},M=async r=>{var u,y;try{const c=await S.post("user/workshops",r);return l.value.push(c.data.row),c.data.row}catch(c){return e.error("Error creating workshop: "+(((y=(u=c.response)==null?void 0:u.data)==null?void 0:y.message)||c.message)),!1}},_e=async r=>{var u,y;try{await S.delete(`user/workshops/${r}`);const c=[...l.value].map(A=>B(A)),v=c.findIndex(A=>A.id_workshop===r);return c.splice(v,1),l.value=c,!0}catch(c){return e.error("Error deleting workshop: "+(((y=(u=c.response)==null?void 0:u.data)==null?void 0:y.message)||c.message)),!1}},ae=async r=>{const u=await S.get(`user/workshops/${r}/fleets`).then(y=>y.data.rows.map(c=>(c.user_ships=c.user_ships.filter(v=>v.visible),c)));j(u)},j=r=>{p.value=r.map(u=>(u.user_ships=u.user_ships.map(y=>({...de.cloneDeep(B(o.value.find(v=>v.id_user_ship===y.id_user_ship))),pivot:y.pivot})),u.stats=ee(u),u.parsedAbilities=te(u),u))};return{userShips:o,isLoadingUserShips:d,isLoadingShips:i,ships:t,shipClasses:a,workshops:l,isLoadingWorkshops:f,selectedFleets:p,selectedFleetsAbilityLists:T,selectedFleetsStats:W,loadShips:H,loadShipClasses:G,loadUserShips:K,loadWorkshops:Q,createWorkshop:M,deleteUserShip:Z,createOrUpdateUserShip:X,deleteWorkshop:_e,loadWorkshopFleets:ae,createOrUpdateFleet:async(r,u,y)=>S.post(`user/workshops/${r}/fleets`,{...y,location:u}).then(c=>c.data.row).then(c=>{const v=p.value;if(y.id_workshop_fleet){const A=v.findIndex(w=>w.id_workshop_fleet===y.id_workshop_fleet);v.splice(A,1,c)}else v.push(c);j(v)}),deleteFleet:async(r,u)=>S.delete(`user/workshops/${r}/fleets/${u}`).then(()=>{const y=p.value.findIndex(v=>v.id_workshop_fleet===parseInt(u)),c=p.value;c.splice(y,1),j(c)}),addUserShipToFleet:(r,u,y)=>S.post(`user/workshops/${r}/fleets/${u}/ships`,{id_user_ship:y}).then(c=>c.data.row).then(c=>{const v=p.value.findIndex(w=>w.id_workshop_fleet===parseInt(u)),A=p.value;A.splice(v,1,c),j(A)}),removeUserShipFromFleet:(r,u,y)=>S.delete(`user/workshops/${r}/fleets/${u}/ships/${y}`).then(c=>c.data.row).then(c=>{const v=p.value.findIndex(w=>w.id_workshop_fleet===parseInt(u)),A=p.value;A.splice(v,1,c),j(A)}),setFleetFlagship:(r,u,y)=>S.post(`user/workshops/${r}/fleets/${u}/flagship`,{id_user_ship:y}).then(c=>c.data.row).then(()=>{const c=p.value.findIndex(w=>w.id_workshop_fleet===parseInt(u)),v=p.value[c],A=[...v.user_ships].map(w=>B(w)).map(w=>({...w,pivot:{...w.pivot,flagship:w.id_user_ship===y}}));p.value[c].user_ships=A,p.value[c].stats=ee(v),p.value[c].parsedAbilities=te(v)}),setSelectedWorkshopId:E,loadSharedWorkshop:async r=>{const u=S.get("data/workshop/"+r).then(v=>v.data.row),y=G();await Promise.all([u,y]);const c=await u;l.value=[c],p.value=c.fleets.map(v=>(v.user_ships.map(b),v.stats=ee(v),v.parsedAbilities=te(v),v)),_.value=c.id_workshop}}});const Ds={class:"fleet-ability-totals"},js={key:0,class:"grid w-full gap-y-2"},qs={class:"total-item__header font-bold text-sm text-modal-title mb-1"},Ws={class:"total-item__description text-xs"},Hs={__name:"FleetAbilityTotals",props:{fleet:{type:Object,required:!0},totals:{type:Object,required:!0}},setup(e){const t=e,i=Ys(),a=O(()=>zs(t.fleet,de.cloneDeep(B(t.totals))).map(d=>({...d,...Vs(t.fleet,d,{shipClasses:i.shipClasses})})));return(o,d)=>{var l;return n(),h("div",Ds,[(l=g(a))!=null&&l.length?(n(),h("div",js,[(n(!0),h(L,null,D(g(a),(f,_)=>(n(),h("div",{class:F(["total-item border-l-4 pl-2 py-1",[`total-item--${f.affectType}`]]),key:f.slug+_},[s("div",qs,x(f.category)+" > "+x(f.affectTypeName),1),s("div",Ws,x(f.description),1)],2))),128))])):I("",!0)])}}},Gs=V(Hs,[["__scopeId","data-v-9f09701a"]]);const Ks={class:"fleet__info grow p-4 rounded min-h-[350px] mb-4 border border-dark-border-start"},Qs={key:0,class:"fleet__used leading-none"},Xs={class:"fleet__ships flex flex-col gap-y-2 mb-8"},Zs=["onClick"],Js={key:1,class:"ship-box__strengths flex gap-x-2 items-center"},ei={class:"ship-box__strengths-total text-center text-xs"},ti={class:"text-base font-medium text-grow-green-text-alt"},si={class:"ship-box__strengths-total text-center text-xs"},ii={class:"text-base font-medium text-grow-green-text-alt"},ai={class:"ship-box__strengths-total text-center text-xs"},li={class:"text-base font-medium text-grow-green-text-alt"},ni={key:0,class:"pt-2 flex flex-wrap gap-1"},oi={key:0,class:"fleet__basic-stats mb-4"},ci={key:1,class:"fleet__total-stats mb-4"},ri={key:1,class:"fleet__placeholder"},di={class:"fleet__button"},hi={key:0,src:"/images/fleet-icon.png"},_i={class:"sleet-slot__label text-xs text-white"},pi={__name:"FleetItem",props:{statTotals:{type:[Object,null],required:!0},location:{type:String,required:!0},locationName:{type:String,required:!0},fleet:{type:Object,default:null},isPublic:{type:Boolean,default:!1},withTags:{type:Boolean,default:!1}},emits:["select","flagship"],setup(e,{emit:t}){const i=e,a=N(""),o=()=>{t("select",{slug:i.location,name:i.locationName},i.fleet)},d=f=>{t("flagship",B(i.fleet),B(f))},l=O(()=>!i.fleet||!i.fleet.stats);return(f,_)=>{var b;const p=q("tooltip");return n(),h("div",{class:F(["fleet flex flex-col h-full",{"fleet--busy":!g(l),"fleet--empty":g(l)}])},[s("div",Ks,[g(l)?(n(),h("div",ri,"No Fleet Assigned")):(n(),h("div",Qs,[C(mt,{fleet:e.fleet},null,8,["fleet"]),s("div",Xs,[(n(!0),h(L,null,D(e.fleet.user_ships,m=>(n(),U(_t,{key:`${m.id_user_ship}-${m.pivot.flagship}`,userShip:m},{actions:z(()=>[e.isPublic?(n(),h("div",Js,[s("div",ei,[k(" Weapons "),s("div",ti,x(m.ship.slotStrengths.weapon.total),1)]),s("div",si,[k(" Armor "),s("div",ii,x(m.ship.slotStrengths.armor.total),1)]),s("div",ai,[k(" Units "),s("div",li,x(m.ship.slotStrengths.unit.total),1)])])):(n(),h(L,{key:0},[m.pivot.flagship?R((n(),U(g(ie),{key:0,class:"text-box-green"},null,512)),[[p,"Fleet Flagship"]]):(n(),h("button",{key:1,class:"btn btn-blue btn-sm",onClick:()=>d(m)},[k(" Set "),C(g(ie))],8,Zs))],64))]),footer:z(()=>[e.withTags?(n(),h("div",ni,[(n(!0),h(L,null,D(m.parsedAbilities,E=>(n(),U(he,{key:E.ability.id_ability,parsedAbility:E},null,8,["parsedAbility"]))),128))])):I("",!0)]),_:2},1032,["userShip"]))),128))]),(b=e.fleet.user_ships)!=null&&b.length?(n(),h("div",oi,[C(ce,{name:"fleet-ability-stats",modelValue:a.value,"onUpdate:modelValue":_[0]||(_[0]=m=>a.value=m)},{title:z(()=>[k(" Stacked Fleet Abilities ")]),body:z(()=>[C($s,{fleet:e.fleet,parsedAbilities:e.fleet.parsedAbilities},null,8,["fleet","parsedAbilities"])]),_:1},8,["modelValue"])])):I("",!0),e.statTotals.totalStats?(n(),h("div",ci,[C(ce,{name:"fleet-ability-totals",modelValue:a.value,"onUpdate:modelValue":_[1]||(_[1]=m=>a.value=m)},{title:z(()=>[k(" Fleet Ability Totals ")]),body:z(()=>[C(Gs,{fleet:e.fleet,totals:e.statTotals.totalStats},null,8,["fleet","totals"])]),_:1},8,["modelValue"])])):I("",!0)]))]),s("div",{class:"fleet__bottom shrink flex flex-col items-center",onClick:o},[s("div",di,[g(l)?(n(),U(g(Ge),{key:1})):(n(),h("img",hi))]),s("div",_i,x(e.locationName),1)])],2)}}},Ai=V(pi,[["__scopeId","data-v-0bf422ad"]]);export{he as A,$i as B,xi as C,Ai as F,Je as I,jt as S,Oe as _,tt as a,mt as b,Ys as u};

import{_ as D,o as i,f as u,a as e,aw as fe,t as y,z as N,A as P,s as z,k as L,j as V,E as C,ak as ve,l as X,m as T,v as E,F,y as B,S as H,e as m,b as x,n as W,c as $,I as K,g as I,p as Q,d as R,r as j,w as U,U as be,B as ye,am as se,ao as xe,ae as Z,$ as q,h as ge,G as re,ax as Se,ay as ke,af as we,C as $e,D as Ce,H as Fe,J as Ue,K as Ae,L as Ie,Q as We,M as Me,O as qe,N as Le,P as De,R as Ve}from"./index-935aeafb.js";import{C as G,I as je,a as Be,A as Oe,u as oe,B as ce,b as de,S as Te,F as Ne}from"./FleetItem-85049dae.js";import{u as Pe}from"./useMustAuthState-96f39df3.js";const Re={props:{label:{type:String,required:!0},modelValue:{type:Boolean,required:!0}}},Ee=t=>(N("data-v-154813cc"),t=t(),P(),t),He={class:"toggle-switch"},ze=["checked"],Ge=Ee(()=>e("span",{class:"switch"},null,-1)),Ye={class:"label"};function Je(t,s,r,n,o,c){return i(),u("label",He,[e("input",fe(t.$attrs,{class:"input",type:"checkbox",checked:r.modelValue,onChange:s[0]||(s[0]=f=>t.$emit("update:modelValue",f.target.checked))}),null,16,ze),Ge,e("span",Ye,y(r.label),1)])}const Ke=D(Re,[["render",Je],["__scopeId","data-v-154813cc"]]);const le=t=>(N("data-v-9f8a73d4"),t=t(),P(),t),Qe=["onSubmit"],Xe={class:"form-group"},Ze=le(()=>e("label",null,"Nickname (optional identifier for your sanity)",-1)),et=["placeholder"],tt={class:"form-group"},st=le(()=>e("label",null,"Chip Level",-1)),ot={class:"chips flex gap-x-1"},lt=["onClick"],nt={key:0,class:"form-group"},it=le(()=>e("label",null,"Visibility",-1)),at={class:"form-group pt-4 flex gap-x-4 justify-between"},rt=["disabled"],ct={key:0},dt=["disabled"],ut={__name:"UserShipForm",props:{ship:{type:Object,required:!0},userShip:{type:Object,default:null},onSave:{type:Function,required:!0},onDelete:{type:Function,default:null}},setup(t){const s=t,r=z(),n=L(!1),o=V({name:"",chip_level:0,visible:!0}),c=async()=>{var _,h,l;n.value=!0;try{s.onSave({...o,id_ship:s.ship.id_ship,id_user_ship:(_=s.userShip)==null?void 0:_.id_user_ship})}catch(a){r.error(((l=(h=error.response)==null?void 0:h.data)==null?void 0:l.message)||a.message)}n.value=!1},f=async _=>{var h,l;if(!s.onDelete)return!1;n.value=!0;try{s.onDelete(_)}catch(a){r.error(((l=(h=error.response)==null?void 0:h.data)==null?void 0:l.message)||a.message)}n.value=!1},b=()=>{s.userShip?(o.name=s.userShip.name,o.chip_level=s.userShip.chip_level,o.visible=s.userShip.visible):(o.name="",o.chip_level=0,o.visible=!0)},d=C(()=>ve(s.ship));return X(()=>s.userShip,()=>{b()},{immediate:!0}),(_,h)=>(i(),u("form",{action:"",class:"user-ship-form",onSubmit:Q(c,["prevent"])},[e("div",Xe,[Ze,T(e("input",{type:"text",class:"input",placeholder:`Example: Best ${t.ship.name}`,"onUpdate:modelValue":h[0]||(h[0]=l=>o.name=l)},null,8,et),[[E,o.name]])]),e("div",tt,[st,e("div",ot,[(i(!0),u(F,null,B(m(d)+1,l=>(i(),u("div",{class:H(["chip cursor-pointer",{"chip--unlocked":l-1<=o.chip_level}]),key:l,onClick:a=>o.chip_level=l-1},y(l-1),11,lt))),128))])]),t.userShip?(i(),u("div",nt,[it,e("div",null,[x(Ke,{modelValue:o.visible,"onUpdate:modelValue":h[1]||(h[1]=l=>o.visible=l),label:o.visible?"Visible to workshops":"Hidden from workshops"},null,8,["modelValue","label"])])])):W("",!0),e("div",at,[e("div",null,[e("button",{class:"btn btn-blue",type:"submit",disabled:n.value},[n.value?(i(),$(m(K),{key:0,class:"animate-spin"})):(i(),u(F,{key:1},[I(y(t.userShip?"Update Ship":"Add Ship"),1)],64))],8,rt)]),t.userShip&&t.onDelete?(i(),u("div",ct,[e("button",{class:"btn btn-red",type:"submit",onClick:h[2]||(h[2]=Q(l=>f(t.userShip),["prevent"])),disabled:n.value},[n.value?(i(),$(m(K),{key:0,class:"animate-spin"})):(i(),u(F,{key:1},[I(" Delete ")],64))],8,dt)])):W("",!0)])],40,Qe))}},ue=D(ut,[["__scopeId","data-v-9f8a73d4"]]);const ht=t=>(N("data-v-7884a63c"),t=t(),P(),t),pt={class:"ship-box__content"},_t={class:"ship-box__content-bg p-2 flex w-full gapx-3"},mt={class:"grow"},ft={class:"ship-box__strengths flex gap-x-2 items-center"},vt=ht(()=>e("div",{class:"mr-4 font-medium"},"Total Strength",-1)),bt={class:"ship-box__strengths-total text-center text-xs"},yt={class:"text-base font-medium text-grow-green-text-alt"},xt={class:"ship-box__strengths-total text-center text-xs"},gt={class:"text-base font-medium text-grow-green-text-alt"},St={class:"ship-box__strengths-total text-center text-xs"},kt={class:"text-base font-medium text-grow-green-text-alt"},wt={class:"ship-box__actions ml-auto shrink"},$t={class:"ship-box__caption"},Ct={__name:"ShipSelectCard",props:{ship:{type:Object,required:!0}},setup(t){return(s,r)=>(i(),u("div",{class:H(["ship ship-box",["ship-box--"+t.ship.ship_level.name.toLowerCase()]])},[e("div",pt,[e("div",_t,[e("div",mt,[e("div",null,"Power "+y(t.ship.energy),1),e("div",null,y(t.ship.abilities.length)+" Abilities",1),e("div",ft,[vt,e("div",bt,[I(" Weapons "),e("div",yt,y(t.ship.slotStrengths.weapon.total),1)]),e("div",xt,[I(" Armor "),e("div",gt,y(t.ship.slotStrengths.armor.total),1)]),e("div",St,[I(" Units "),e("div",kt,y(t.ship.slotStrengths.unit.total),1)])])]),e("div",wt,[R(s.$slots,"actions",{},void 0,!0)])])]),e("div",$t,y(t.ship.name),1)],2))}},Ft=D(Ct,[["__scopeId","data-v-7884a63c"]]),Ut={class:"add-ship__filters flex gap-x-4 items-center mb-4"},At=e("div",{class:"text-modal-title font-medium"},"Filter by name",-1),It=e("div",{class:"text-modal-title font-medium"},"Filter by class",-1),Wt={key:0,class:"pt-6"},Mt={class:"add-ships__list flex flex-col w-full gap-y-2"},qt=["onClick"],Lt={__name:"ShipSelectList",props:{ships:{type:Array,required:!0},shipClasses:{type:Array,required:!0}},emits:["select"],setup(t,{emit:s}){const r=t,n=d=>{s("select",d)},o=V({search:"",id_class:null}),c=C(()=>Object.values(o).some(d=>!!d)),f=()=>{o.search="",o.id_class=null},b=C(()=>{let d=[...r.ships];return o.search&&(d=d.filter(_=>_.name.toLowerCase().includes(o.search.toLowerCase()))),o.id_class&&(d=d.filter(_=>_.id_class===o.id_class)),d});return(d,_)=>{const h=j("VSelect");return i(),u(F,null,[e("div",Ut,[e("div",null,[At,T(e("input",{type:"text",class:"input input--search",placeholder:"Search by name...","onUpdate:modelValue":_[0]||(_[0]=l=>o.search=l)},null,512),[[E,o.search]])]),e("div",null,[It,x(h,{options:t.shipClasses,reduce:l=>l.id_class,searchable:!0,clearable:!0,label:"name",modelValue:o.id_class,"onUpdate:modelValue":_[1]||(_[1]=l=>o.id_class=l)},null,8,["options","reduce","modelValue"])]),m(c)?(i(),u("div",Wt,[e("button",{class:"btn btn-sm btn-red",onClick:f}," Clear filters ")])):W("",!0)]),e("div",Mt,[(i(!0),u(F,null,B(m(b),l=>(i(),$(Ft,{key:l.id_ship,ship:l},{actions:U(()=>[e("button",{class:"btn btn-sm btn-green",onClick:a=>n(l)}," Select ",8,qt)]),_:2},1032,["ship"]))),128))])],64)}}};const Dt={class:"add-ship"},Vt={class:"text-xl text-modal-title font-medium mb-4"},jt={class:"flex gap-x-4 items-center mb-4"},Bt={class:"text-xl text-modal-title"},Ot={__name:"AddShipModal",props:{ships:{type:Array,required:!0},shipClasses:{type:Array,required:!0},onAdd:{type:Function,required:!0},title:{type:String,default:"Add a ship to your fleet"}},setup(t){const s=t,r=L(null),n=c=>{r.value=c},o=c=>s.onAdd(c);return(c,f)=>{const b=j("vue-final-modal");return i(),$(b,{classes:"modal-container","content-class":"w-full modal-content--xl"},{default:U(()=>[x(G,{class:"w-full","bg-class":"custom-bg"},{default:U(()=>[e("div",Dt,[e("h2",Vt,y(t.title),1),r.value?(i(),u(F,{key:0},[e("div",jt,[e("div",null,[e("button",{class:"btn btn-sm btn-red",onClick:f[0]||(f[0]=d=>r.value=null)}," Unselect Ship ")]),e("div",null,[e("h2",Bt,[I(" Add "),e("b",null,y(r.value.name),1),I(" to your fleet ")])])]),x(ue,{ship:r.value,onSave:o},null,8,["ship"])],64)):(i(),$(Lt,{key:1,ships:t.ships,shipClasses:t.shipClasses,onSelect:n},null,8,["ships","shipClasses"]))])]),_:1})]),_:1})}}};const Tt=t=>(N("data-v-221f881d"),t=t(),P(),t),Nt={class:"ship-box__content"},Pt={class:"ship-box__content-bg p-2 flex w-full gap-x-3"},Rt={class:"shrink"},Et={class:"flex w-full justify-between"},Ht={class:"flex gap-x-2 items-center text-sm mb-1"},zt={class:"flex gap-x-[2px] items-center"},Gt={class:"ship-box__strengths flex gap-x-2 items-center"},Yt={class:"ship-box__strengths-total text-center text-xs"},Jt={class:"text-base font-medium text-grow-green-text-alt"},Kt={class:"ship-box__strengths-total text-center text-xs"},Qt={class:"text-base font-medium text-grow-green-text-alt"},Xt={class:"ship-box__strengths-total text-center text-xs"},Zt={class:"text-base font-medium text-grow-green-text-alt"},es={class:"ship__tags grow"},ts={key:0,class:"flex flex-wrap gap-[2px]"},ss={class:"ship__actions"},os=Tt(()=>e("button",{class:"btn btn-sm btn-green ml-auto"}," Edit ",-1)),ls={class:"ship-box__caption flex gap-x-4 justify-center"},ns={class:"text-white italic"},is={__name:"UserShipCard",props:{userShip:{type:Object,required:!0},showTags:{type:Boolean,default:!0}},setup(t){return(s,r)=>{const n=be("tooltip");return T((i(),u("div",{class:H(["ship ship-box relative leading-none",["ship-box--"+t.userShip.ship.ship_level.name.toLowerCase(),{"ship--hidden":!t.userShip.visible}]])},[e("div",Nt,[e("div",Pt,[e("div",Rt,[e("div",Et,[e("div",Ht,[e("div",null,y(t.userShip.ship.ship_class.name),1),e("div",zt,[e("div",null,[x(m(je))]),e("div",null,y(t.userShip.ship.energy),1)]),e("div",null,[x(Be,{total:t.userShip.ship.chipCount,chipLevel:t.userShip.chip_level,height:"8px"},null,8,["total","chipLevel"])])])]),e("div",Gt,[e("div",Yt,[I(" Weapons "),e("div",Jt,y(t.userShip.ship.slotStrengths.weapon.total),1)]),e("div",Kt,[I(" Armor "),e("div",Qt,y(t.userShip.ship.slotStrengths.armor.total),1)]),e("div",Xt,[I(" Units "),e("div",Zt,y(t.userShip.ship.slotStrengths.unit.total),1)])])]),e("div",es,[R(s.$slots,"tags",{},()=>{var o;return[t.showTags&&((o=t.userShip.parsedAbilities)!=null&&o.length)?(i(),u("div",ts,[(i(!0),u(F,null,B(t.userShip.parsedAbilities,c=>(i(),$(Oe,{key:c.ability.id_ability,parsedAbility:c},null,8,["parsedAbility"]))),128))])):W("",!0)]},!0)]),e("div",ss,[R(s.$slots,"actions",{},()=>[os],!0)])])]),e("div",ls,[e("div",null,y(t.userShip.ship.name),1),e("div",ns,y(t.userShip.name),1)])],2)),[[n,t.userShip.visible?!1:"Hidden from workshops"]])}}},ne=D(is,[["__scopeId","data-v-221f881d"]]);const as={class:"add-ship"},rs=e("h2",{class:"text-xl text-modal-title font-medium mb-4"}," Update your ship ",-1),cs={__name:"UserShipModal",props:{userShip:{type:Object,required:!0},onSave:{type:Function,required:!0},onDelete:{type:Function,default:null}},setup(t){const s=t,r=o=>s.onSave(o),n=o=>{if(s.onDelete)return s.onDelete(o)};return(o,c)=>{const f=j("vue-final-modal");return i(),$(f,{classes:"modal-container","content-class":"w-full modal-content--xl"},{default:U(()=>[x(G,{class:"w-full","bg-class":"custom-bg"},{default:U(()=>[e("div",as,[rs,x(ue,{ship:t.userShip.ship,userShip:t.userShip,onSave:r,onDelete:n},null,8,["ship","userShip"])])]),_:1})]),_:1})}}};const Y=t=>(N("data-v-74af7c7c"),t=t(),P(),t),ds=["onSubmit"],us={class:"create-workshop"},hs=Y(()=>e("h2",{class:"text-xl text-modal-title font-medium mb-2"}," Create Workshop ",-1)),ps=Y(()=>e("p",{class:"text-white mb-4"},"Select your Workshop type",-1)),_s={class:"lg:flex gap-x-4 mb-4"},ms=Y(()=>e("h2",{class:"text-white text-xl mb-4"},"Arcade Workshop",-1)),fs=Y(()=>e("p",{class:"text-dark-text-white"}," Create with no restrictions! Use your same ship as many times as you want. ",-1)),vs=[ms,fs],bs=Y(()=>e("h2",{class:"text-white text-xl mb-4"},"Simulation Workshop",-1)),ys=Y(()=>e("p",{class:"text-dark-text-white"}," More realistic. You can only use each of the ships in your fleet one time. ",-1)),xs=[bs,ys],gs={class:"form-group"},Ss={class:"form-group"},ks=["disabled"],ws={__name:"WorkshopForm",props:{workshop:{type:Object,default:null},onSave:{type:Function,required:!0}},setup(t){const s=t,r=z(),n=V({name:"",arcade:!0}),o=V({name:""}),c=V({name:!1}),f=L(!1),b=L(!1),d=()=>(o.name=n.name?"":"Name is required",!Object.values(o).some(h=>h)),_=async()=>{if(f.value=!0,b.value)try{await s.onSave(n)}catch(h){r.error(h.message)}f.value=!1};return X(n,()=>{b.value=d()}),ye(()=>{s.workshop&&(n.name=s.workshop.name,n.arcade=s.workshop.arcade)}),(h,l)=>(i(),u("form",{action:"",onSubmit:Q(_,["prevent"])},[e("div",us,[hs,ps,e("div",_s,[e("div",{class:H(["p-4 bordered lg:w-1/2 text-center",{"bordered--selected":n.arcade}]),onClick:l[0]||(l[0]=a=>n.arcade=!0)},vs,2),e("div",{class:H(["p-4 bordered lg:w-1/2",{"bordered--selected":!n.arcade}]),onClick:l[1]||(l[1]=a=>n.arcade=!1)},xs,2)]),e("div",gs,[T(e("input",{class:"input",type:"text",placeholder:"Fleet name","onUpdate:modelValue":l[2]||(l[2]=a=>n.name=a)},null,512),[[E,n.name]]),x(se,{error:o.name,dirty:c.name},null,8,["error","dirty"])]),e("div",Ss,[e("button",{class:"btn btn-blue",disabled:!b.value}," Create Workshop ",8,ks)])])],40,ds))}},$s=D(ws,[["__scopeId","data-v-74af7c7c"]]);const Cs={__name:"CreateWorkshopModal",props:{workshop:{type:Object,default:null},onSave:{type:Function,required:!0}},setup(t){const s=t;return(r,n)=>{const o=j("vue-final-modal");return i(),$(o,{classes:"modal-container","content-class":"w-full modal-content--xl"},{default:U(()=>[x(G,{class:"w-full","bg-class":"custom-bg"},{default:U(()=>[x($s,{onSave:s.onSave,workshop:t.workshop},null,8,["onSave","workshop"])]),_:1})]),_:1})}}},Fs=D(Cs,[["__scopeId","data-v-ee57fd14"]]);const Us={class:"flex items-center"},As={class:"border-r border-dark-border-end pr-4 grow"},Is={class:"flex w-100"},Ws={class:"mr-4"},Ms={class:"text-sm text-dark-text"},qs={class:"text-2xl font-medium text-dark-text leading-none text-white"},Ls={class:"self-end ml-auto"},Ds={class:"text-sm"},Vs={class:"text-sm"},js={class:"pl-4 shrink"},Bs=["onClick"],Os={__name:"WorkshopListItem",props:{workshop:{type:Object,default:null},onDelete:{type:Function,required:!0}},emits:["select"],setup(t,{emit:s}){const r=t,n=C(()=>r.workshop.fleets.length),o=C(()=>r.workshop.fleets.reduce((b,d)=>b+d.user_ships.length,0)),c=()=>{r.onDelete(Z(r.workshop))},f=()=>{s("select",Z(r.workshop))};return(b,d)=>(i(),u("div",{class:"workshop-list-item cursor-pointer p-4",onClick:f},[e("div",Us,[e("div",As,[e("div",Is,[e("div",Ws,[e("div",Ms,y(t.workshop.arcade?"Arcade":"Simulation"),1),e("div",qs,y(t.workshop.name),1)]),e("div",Ls,[e("div",Ds,[I(" Ships: "),e("b",null,y(m(o)),1)]),e("div",Vs,[I(" Fleets: "),e("b",null,y(m(n)),1)])])])]),e("div",js,[e("button",{class:"btn btn-red btn-sm",onClick:Q(c,["stop","prevent"])},[x(m(xe))],8,Bs)])])]))}},Ts=D(Os,[["__scopeId","data-v-454717a1"]]);const Ns={class:"modal__title text-2xl font-medium mb-8"},Ps={class:"modal__content p-6 mb-6"},Rs={class:"modal__footer flex justify-end items-center gap-x-3"},Es=["onClick"],Hs=["onClick"],te=t=>{q.show({component:"confirm-modal",bind:{title:t.title,message:t.message,onConfirm:t.onConfirm,onCancel:t.onCancel,confirmBtnClass:t.confirmBtnClass}})},zs={__name:"ConfirmModal",props:{onConfirm:{type:Function,required:!0},onCancel:{type:Function,default:null},title:{type:String,default:!1},message:{type:String,default:!1},confirmBtnClass:{type:String,default:"btn-red"}},setup(t){const s=t,r=o=>{s.onCancel(),o()},n=o=>{typeof s.onConfirm=="function"&&s.onConfirm(),o()};return(o,c)=>{const f=j("vue-final-modal");return i(),$(f,{name:"confirm-modal",classes:"modal-container","content-class":"w-full modal-content--xl"},{default:U(({close:b})=>[x(G,{class:"w-full text-modal-text","bg-class":"custom-bg"},{default:U(()=>[e("div",Ns,[R(o.$slots,"title",{},()=>[I(y(t.title),1)],!0)]),e("div",Ps,[R(o.$slots,"default",{},()=>[I(y(t.message),1)],!0)]),e("div",Rs,[R(o.$slots,"buttons",{},()=>[e("button",{class:"btn btn-blue",onClick:d=>r(b)}," Cancel ",8,Es),e("button",{class:H(["btn",t.confirmBtnClass]),onClick:d=>n(b)}," Confirm ",10,Hs)],!0)])]),_:2},1024)]),_:3})}}},Gs=D(zs,[["__scopeId","data-v-53e089bb"]]);const he=t=>(N("data-v-307b12f5"),t=t(),P(),t),Ys={class:"my-fleets flex w-full justify-center items-center"},Js={class:"my-fleets__content w-full max-w-6xl p-6 text-modal-text"},Ks={class:"lg:flex w-full items-stretch gap-x-6"},Qs={class:"my-fleets__fleets h-full grow"},Xs={class:"flex items-end w-full mb-2"},Zs=he(()=>e("div",null,[e("div",{class:"title text-2xl text-modal-title font-medium leading-none"}," My Ships ")],-1)),eo={class:"ml-auto"},to={class:"bordered p-4"},so={class:"user-ships grid grid-cols-2 gap-3 w-full"},oo={key:0,class:"placeholder p-10 flex justify-center items-center text-center text-xl h-full"},lo={key:1,class:"p-10 flex justify-center items-center text-3xl"},no={class:"my-fleets__workshops h-full shrink-0 lg:max-w-[410px]"},io={class:"flex w-full items-end mb-2"},ao=he(()=>e("div",null,[e("div",{class:"title leading-none text-2xl text-modal-title font-medium"}," My Workshops ")],-1)),ro={class:"ml-auto"},co={class:"bordered p-4 grid gap-y-2"},uo={key:0,class:"flex placeholder p-10 justify-center items-center text-center text-xl h-full"},ho={key:1,class:"p-10 flex justify-center items-center text-3xl"},po={__name:"MyFleets",setup(t){const s=oe(),r=ge(),n=z(),o=()=>{q.show({component:Fs,bind:{onSave:async a=>{await s.createWorkshop(a),q.hideAll()}}})},c=()=>{q.show({component:Ot,bind:{ships:s.ships,shipClasses:s.shipClasses,onAdd:async a=>{await s.createOrUpdateUserShip(a),q.hideAll()}}})},f=a=>{q.show({component:cs,bind:{ship:a.ship,userShip:a,onSave:async v=>{await s.createOrUpdateUserShip(v),q.hideAll()},onDelete:async v=>{await s.deleteUserShip(v.id_user_ship),q.hideAll()}}})},b=a=>{r.push({name:"builder.workshop",params:{id_workshop:a.id_workshop}})},d=async a=>{te({title:`Really delete ${a.arcade?"arcade":"simulation"} workshop "${a.name}" ?`,message:"On a moral level, it's totally fine. Your ships will be fine, as well. But all fleet configurations will be gone. Proceed?",onConfirm:()=>{_(a)}})},_=async a=>{te({title:"For sure?",message:`Think of all the fun you and workshop "${a.name}" had together.`,onConfirm:()=>{h(a)}})},h=async a=>{te({title:"Last chance for real!",message:"Think of the children...",onConfirm:()=>{s.deleteWorkshop(a.id_workshop),n.info("Workshop delete successfully")}})},l=L(!1);return re(()=>{const a=s.ships.length?Promise.resolve():s.loadShips(),v=s.userShips.length?Promise.resolve():s.loadUserShips(),p=s.shipClasses.length?Promise.resolve():s.loadShipClasses(),k=s.workshops.length?Promise.resolve():s.loadWorkshops();Promise.all([a,v,p,k]).then(()=>{l.value=!0})}),(a,v)=>(i(),$(ce,null,{default:U(()=>[e("div",Ys,[e("div",Js,[e("div",Ks,[e("div",Qs,[e("div",Xs,[Zs,e("div",eo,[l.value?(i(),u("button",{key:0,class:"btn btn-blue btn-sm ml-4",onClick:c}," Add Ship ")):W("",!0)])]),e("div",to,[l.value?(i(),u(F,{key:0},[e("div",so,[(i(!0),u(F,null,B(m(s).userShips,p=>(i(),$(ne,{key:p.id_user_ship,userShip:p,showTags:!1,onClick:k=>f(p)},null,8,["userShip","onClick"]))),128))]),m(s).userShips.length?W("",!0):(i(),u("div",oo," There are no ships in your fleet. Create one. "))],64)):(i(),u("div",lo,[x(m(K),{class:"animate-spin"})]))])]),e("div",no,[e("div",io,[ao,e("div",ro,[l.value?(i(),u("button",{key:0,class:"btn btn-blue btn-sm ml-4",onClick:o}," Add Workshop ")):W("",!0)])]),e("div",co,[l.value?(i(),u(F,{key:0},[(i(!0),u(F,null,B(m(s).workshops,p=>(i(),$(Ts,{key:p.id_workshop,workshop:p,onDelete:d,onSelect:b},null,8,["workshop"]))),128)),m(s).workshops.length?W("",!0):(i(),u("div",uo," No workshops yet. Create one! "))],64)):(i(),u("div",ho,[x(m(K),{class:"animate-spin"})]))])])])])])]),_:1}))}},_o=D(po,[["__scopeId","data-v-307b12f5"]]),mo={class:"add-ship__filters flex gap-x-4 items-center mb-4"},fo=e("div",{class:"text-modal-title font-medium"},"Filter by name",-1),vo=e("div",{class:"text-modal-title font-medium"},"Filter by class",-1),bo={key:0,class:"pt-6"},yo={class:"add-ships__list flex flex-col w-full gap-y-2"},xo={key:0,class:"btn btn-sm btn-gray",disabled:""},go=["onClick"],So=["onClick"],ko={key:1,class:"btn btn-sm btn-gray",disabled:""},wo={__name:"UserShipSelectList",props:{userShips:{type:Array,required:!0},shipClasses:{type:Array,required:!0},busy:{type:Boolean,default:!1},energyLimit:{type:Number,default:null}},emits:["select","unselect"],setup(t,{emit:s}){const r=t,n=l=>{s("select",l)},o=l=>{s("unselect",l)},c=V({search:"",id_class:null}),f=C(()=>Object.values(c).some(l=>!!l)),b=()=>{c.search="",c.id_class=null},d=C(()=>r.energyLimit!==null),_=l=>d.value?l<=r.energyLimit:!0,h=C(()=>{let l=[...r.userShips];return c.search&&(l=l.filter(a=>a.ship.name.toLowerCase().includes(c.search.toLowerCase()))),c.id_class&&(l=l.filter(a=>a.ship.id_class===c.id_class)),l});return(l,a)=>{const v=j("VSelect");return i(),u(F,null,[e("div",mo,[e("div",null,[fo,T(e("input",{type:"text",class:"input input--search",placeholder:"Search by name...","onUpdate:modelValue":a[0]||(a[0]=p=>c.search=p)},null,512),[[E,c.search]])]),e("div",null,[vo,x(v,{options:t.shipClasses,reduce:p=>p.id_class,searchable:!0,clearable:!0,label:"name",modelValue:c.id_class,"onUpdate:modelValue":a[1]||(a[1]=p=>c.id_class=p)},null,8,["options","reduce","modelValue"])]),m(f)?(i(),u("div",bo,[e("button",{class:"btn btn-sm btn-red",onClick:b}," Clear filters ")])):W("",!0)]),e("div",yo,[(i(!0),u(F,null,B(m(h),p=>(i(),$(ne,{key:p.id_user_ship,userShip:p},{actions:U(()=>[t.busy?(i(),u("button",xo,[x(m(K),{class:"animate-spin"})])):p.selected?(i(),u("button",{key:1,class:"btn btn-sm btn-red",onClick:k=>o(p)}," Unselect ",8,go)):(i(),u(F,{key:2},[_(p.ship.energy)?(i(),u("button",{key:0,class:"btn btn-sm btn-green",onClick:k=>n(p)}," Select ",8,So)):(i(),u("button",ko," Not enough energy "))],64))]),_:2},1032,["userShip"]))),128))])],64)}}};const $o={__name:"SelectUserShipModal",props:{fleet:{type:Object,required:!0},userShips:{type:Object,required:!0},shipClasses:{type:Array,required:!0},busy:{type:Object,default:!1}},emits:["select","unselect"],setup(t,{emit:s}){const r=t,n=d=>{s("select",d)},o=d=>{s("unselect",d)},c=C(()=>r.busy.value),f=C(()=>r.userShips.value),b=C(()=>{var d,_;return((_=(d=r.fleet.value)==null?void 0:d.stats)==null?void 0:_.leadershipRemaining)||null});return(d,_)=>{const h=j("vue-final-modal");return i(),$(h,{classes:"modal-container","content-class":"w-full modal-content--lg"},{default:U(()=>[x(G,{class:"w-full","bg-class":"custom-bg"},{default:U(()=>[t.fleet.value?(i(),$(de,{key:0,fleet:t.fleet.value,class:"bg-dark-bg-start/50 p-4"},null,8,["fleet"])):W("",!0),x(wo,{userShips:m(f),shipClasses:t.shipClasses,busy:m(c),energyLimit:m(b),onSelect:n,onUnselect:o},null,8,["userShips","shipClasses","busy","energyLimit"])]),_:1})]),_:1})}}};const pe=t=>(N("data-v-862ee410"),t=t(),P(),t),Co=["onSubmit"],Fo={class:"flex gap-x-3 justify-between"},Uo={class:"text-xl modal__title font-medium mb-6"},Ao={key:0},Io=["disabled"],Wo={class:"form-group"},Mo=pe(()=>e("label",null,"Fleet Name",-1)),qo={class:"form-group mb-10"},Lo=pe(()=>e("label",null,"Leadership Capacity",-1)),Do={key:0,class:"select-list p-4 mb-8 flex flex-col gap-y-2"},Vo=["onClick"],jo={class:"form-group pt-4"},Bo=["disabled"],Oo={key:0},To={key:1},No={__name:"FleetFormModal",props:{idWorkshop:{type:Number,required:!0},location:{type:Object,required:!0},fleet:{type:Object,default:null},onSave:{type:Function,required:!0},onDelete:{type:Function,required:!0},excludeSelected:{type:Boolean,default:!1},onSelectShip:{type:Function,required:!0},onUnselectShip:{type:Function,required:!0}},setup(t){const s=t,r=z(),n=oe(),o=V({name:"",leadership:0}),c=V({name:"",leadership:""}),f=V({name:!1,leadership:!1}),b=L(!1),d=L(""),_=L(!1),h=L(!1),l=()=>{o.name?c.name="":c.name="Name is required",o.leadership?c.leadership="":c.leadership="Leadership is required",b.value=!Object.values(c).some(w=>!!w)},a=async()=>{var w,g,A;if(b.value){_.value=!0;try{await s.onSave(s.location.slug,{...Z(o),id_workshop_fleet:(w=s.fleet)==null?void 0:w.id_workshop_fleet})}catch(S){r.error(((A=(g=S.response)==null?void 0:g.data)==null?void 0:A.message)||S.message)}_.value=!1}},v=async w=>{_.value=!0;try{await s.onDelete(w)}catch(g){d.value=g.message}_.value=!1},p=async w=>{var g,A;h.value=!0;try{await s.onUnselectShip(s.fleet.id_workshop_fleet,w.id_user_ship)}catch(S){r.error(((A=(g=S.response)==null?void 0:g.data)==null?void 0:A.message)||S.message)}h.value=!1},k=async w=>{var g,A;h.value=!0;try{await s.onSelectShip(s.fleet.id_workshop_fleet,w.id_user_ship)}catch(S){r.error(((A=(g=S.response)==null?void 0:g.data)==null?void 0:A.message)||S.message)}h.value=!1},_e=()=>{q.show({component:$o,bind:{fleet:J,userShips:me,shipClasses:ae.value,busy:h,onSelect:k,onUnselect:p}})},J=C(()=>{var g;return(g=n.selectedFleets)==null?void 0:g.find(A=>{var S;return A.id_workshop_fleet===((S=s.fleet)==null?void 0:S.id_workshop_fleet)})}),ie=C(()=>{var w;return(w=n.selectedFleets)==null?void 0:w.reduce((g,A)=>[...g,...A.user_ships.map(S=>S.id_user_ship)],[])}),ae=C(()=>n.shipClasses),me=C(()=>{var S,ee;const w=(ee=(S=J.value)==null?void 0:S.user_ships)==null?void 0:ee.map(M=>M.id_user_ship);let g=n.userShips.map(M=>Z(M)).filter(M=>M.visible);s.excludeSelected&&(g=g.filter(M=>w.includes(M.id_user_ship)?!0:!ie.value.includes(M.id_user_ship)));const A=g.map(M=>({...M,selected:ie.value.includes(M.id_user_ship)}));return Se(A,w),A});return X(o,l,{immediate:!0}),X(J,w=>{w&&(o.name=w.name,o.leadership=w.leadership)},{immediate:!0}),(w,g)=>{const A=j("vue-final-modal");return i(),$(A,{classes:"modal-container","content-class":"w-full modal-content--xl"},{default:U(()=>[x(G,{class:"w-full","bg-class":"custom-bg"},{default:U(()=>[e("form",{action:"",class:"fleet-form",onSubmit:Q(a,["prevent"])},[e("div",Fo,[e("div",null,[e("h2",Uo,y(t.location.name),1)]),t.fleet?(i(),u("div",Ao,[e("button",{class:"btn btn-red btn-sm",type:"button",onClick:g[0]||(g[0]=S=>v(t.fleet.id_workshop_fleet)),disabled:_.value},[_.value?(i(),u(F,{key:0},[I(" Deleting... ")],64)):(i(),u(F,{key:1},[I(" Delete ")],64))],8,Io)])):W("",!0)]),e("div",Wo,[Mo,T(e("input",{type:"text",class:"form-control","onUpdate:modelValue":g[1]||(g[1]=S=>o.name=S)},null,512),[[E,o.name]]),x(se,{error:c.name,dirty:f.name},null,8,["error","dirty"])]),e("div",qo,[Lo,T(e("input",{type:"text",class:"form-control","onUpdate:modelValue":g[2]||(g[2]=S=>o.leadership=S)},null,512),[[E,o.leadership]]),x(se,{error:c.leadership,dirty:f.leadership},null,8,["error","dirty"])]),e("div",{class:"mb-2"},[e("button",{type:"button",class:"btn btn-bright-blue btn-sm",onClick:_e}," Add Ship ")]),t.fleet?(i(),u("div",Do,[x(de,{fleet:m(J),class:"mb-4"},null,8,["fleet"]),(i(!0),u(F,null,B(m(J).user_ships,S=>(i(),$(ne,{key:S.id_user_ship,userShip:S,shipClasses:m(ae)},{actions:U(()=>[e("button",{class:"btn btn-sm btn-red",type:"button",onClick:ee=>p(S)}," Unselect ",8,Vo)]),_:2},1032,["userShip","shipClasses"]))),128))])):W("",!0),e("div",jo,[e("button",{class:"btn btn-blue w-full block",disabled:!b.value||_.value,type:"submit"},[_.value?(i(),u("span",Oo,"Saving...")):(i(),u("span",To,"Save"))],8,Bo)])],40,Co)]),_:1})]),_:1})}}},Po=D(No,[["__scopeId","data-v-862ee410"]]),Ro={viewBox:"0 0 448 512",width:"1.2em",height:"1.2em"},Eo=e("path",{fill:"currentColor",d:"m257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"},null,-1),Ho=[Eo];function zo(t,s){return i(),u("svg",Ro,Ho)}const Go={name:"fa-solid-arrow-left",render:zo},Yo={class:"share-bar"},Jo={class:"flex rounded dark-border-end border-1 overflow-hidden items-stretch"},Ko=["value"],Qo={__name:"ShareWorkshop",props:{id_workshop:{type:[String,Number],required:!0}},setup(t){const s=t,r=L(null),n=z(),o=C(()=>window.location.origin+"/share/"+s.id_workshop),{copy:c,isSupported:f}=ke(),b=async()=>{await c(r),d()},d=we.debounce(()=>{f.value&&n.success("Copied to clipboard")},750),_=l=>{b(),l.target.select(),l.target.setSelectionRange(0,9999)},h=()=>{_({target:r.value})};return(l,a)=>(i(),u("div",Yo,[e("div",Jo,[e("div",{class:"bg-box-gray text-box-gray-text flex justify-center items-center px-3 cursor-pointer",onClick:h},[x(m(Te))]),e("div",null,[e("input",{ref_key:"inputRef",ref:r,type:"text",class:"input-clean",readonly:"",value:m(o),onFocus:_},null,40,Ko)])])]))}};const Xo={class:"workshop max-w-6xl flex flex-col justify-center mx-auto pt-6"},Zo={class:"workshop__heading mb-8"},el={class:"mb-2"},tl={class:"flex items-center"},sl={class:"text-2xl font-medium mb-2 modal__title"},ol={class:"font-xl text-white"},ll={class:"ml-auto"},nl={class:"workshop__content w-full text-modal-text"},il={class:"grid gap-x-4 gap-y-8 w-full"},al={__name:"Workshop",setup(t){const s=$e(),r=Ce.getFleetLocations(),n=oe(),o=L(!1),c=z(),f=(h,l)=>{var a;q.show({component:Po,bind:{idWorkshop:(a=d.value)==null?void 0:a.id_workshop,location:h,fleet:l,excludeSelected:!d.value.arcade,onSave:async(v,p)=>{var k;await n.createOrUpdateFleet((k=d.value)==null?void 0:k.id_workshop,v,p),c.success("Fleet saved successfully")},onDelete:async v=>{var p;await n.deleteFleet((p=d.value)==null?void 0:p.id_workshop,v),q.hideAll()},onSelectShip:(v,p)=>{var k;return n.addUserShipToFleet((k=d.value)==null?void 0:k.id_workshop,v,p)},onUnselectShip:(v,p)=>{var k;return n.removeUserShipFromFleet((k=d.value)==null?void 0:k.id_workshop,v,p)}}})},b=(h,l)=>{var a;return n.setFleetFlagship((a=d.value)==null?void 0:a.id_workshop,h.id_workshop_fleet,l.id_user_ship).catch(v=>{var p,k;console.warn("Error setting flagship",v),c.error(((k=(p=v.response)==null?void 0:p.data)==null?void 0:k.message)||v.message)})},d=C(()=>n.workshops.find(h=>h.id_workshop===parseInt(s.params.id_workshop))),_=C(()=>(console.log("computing fleet locations"),r.map(h=>{var a,v;const l=(a=n.selectedFleets)==null?void 0:a.find(p=>p.location===h.slug);return{...h,statTotals:l&&((v=n.selectedFleetsStats)==null?void 0:v[l.id_workshop_fleet])||null,fleet:l}})));return re(async()=>{const h=n.ships.length?Promise.resolve():n.loadShips(),l=n.userShips.length?Promise.resolve():n.loadUserShips(),a=n.shipClasses.length?Promise.resolve():n.loadShipClasses(),v=n.workshops.length?Promise.resolve():n.loadWorkshops();await Promise.all([h,l,a,v]).then(()=>{o.value=!0}),n.setSelectedWorkshopId(s.params.id_workshop)}),(h,l)=>{const a=j("router-link");return i(),$(ce,null,{default:U(()=>{var v,p;return[e("div",Xo,[e("div",Zo,[e("div",el,[x(a,{class:"text-grow-green-text-alt flex gap-x-2 items-center",to:{name:"builder.fleets"}},{default:U(()=>[x(m(Go)),I(" Back to Fleets ")]),_:1},8,["to"])]),e("div",tl,[e("div",null,[e("h1",sl,y(((v=m(d))==null?void 0:v.name)||"Workshop"),1),e("p",ol,y((p=m(d))!=null&&p.arcade?"Arcade":"Simulation"),1)]),e("div",ll,[x(Qo,{id_workshop:m(s).params.id_workshop},null,8,["id_workshop"])])])]),e("div",nl,[e("div",il,[(i(!0),u(F,null,B(m(_),k=>(i(),$(Ne,{key:k.slug,location:k.slug,locationName:k.name,fleet:k.fleet,statTotals:k.statTotals,onSelect:f,onFlagship:b},null,8,["location","locationName","fleet","statTotals"]))),128))])])])]}),_:1})}}},rl=D(al,[["__scopeId","data-v-a83a9c07"]]),cl=[{path:"/",component:_o,name:"builder.fleets"},{path:"/workshop/:id_workshop",component:rl,name:"builder.workshop"}],dl=Fe({history:Ue("/builder"),routes:cl}),O=Ae(Ve),ul=Ie();O.use(ul);O.component("VSelect",We);O.component("ConfirmModal",Gs);O.use(dl);O.use(Me);O.directive("tooltip",qe);O.use(Le,{position:De.TOP_RIGHT,timeout:3e3});O.mount("#app");Pe();
